# ========================================================
# Prometheus Alert Rules — UniHR SaaS
# ========================================================

groups:
  - name: unihr-backend
    rules:
      # ── High Error Rate ──
      - alert: HighErrorRate
        expr: |
          (
            sum(rate(http_requests_total{status=~"5.."}[5m]))
            /
            sum(rate(http_requests_total[5m]))
          ) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High HTTP 5xx error rate (>5%)"
          description: "{{ $value | humanizePercentage }} of requests are failing."

      # ── High Latency ──
      - alert: HighLatency
        expr: |
          histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))
          > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High request latency (p95 > 2s)"
          description: "95th percentile latency is {{ $value }}s."

      # ── Service Down ──
      - alert: ServiceDown
        expr: up{job="unihr-backend"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "UniHR backend is down"
          description: "The backend service has been unreachable for over 1 minute."

      # ── Too Many In-Progress Requests ──
      - alert: HighConcurrency
        expr: sum(http_requests_in_progress) > 100
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High number of concurrent requests (>100)"
          description: "{{ $value }} requests are currently in-progress."
