# UniHR â€” å¤šç§Ÿæˆ¶å‹è³‡ AI SaaS å¹³å°

> çµåˆå°ç£å‹å‹•æ³•å°ˆæ¥­çŸ¥è­˜èˆ‡ä¼æ¥­å…§è¦çš„å¤šç§Ÿæˆ¶ B2B SaaSï¼Œè®“æ¯å®¶å…¬å¸æ“æœ‰ç¨ç«‹çš„ AI å•ç­”åŠ©ç†ã€æ–‡ä»¶çŸ¥è­˜åº«èˆ‡ç®¡ç†å¾Œå°ã€‚

---

## ç›®éŒ„

- [ç³»çµ±ç°¡ä»‹](#ç³»çµ±ç°¡ä»‹)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [æŠ€è¡“æ£§](#æŠ€è¡“æ£§)
- [æ–‡ä»¶è™•ç†å¼•æ“](#æ–‡ä»¶è™•ç†å¼•æ“)
- [é€²éšæª¢ç´¢å¼•æ“](#é€²éšæª¢ç´¢å¼•æ“)
- [å¤šç§Ÿæˆ¶éš”é›¢](#å¤šç§Ÿæˆ¶éš”é›¢)
- [å‰ç«¯é é¢](#å‰ç«¯é é¢)
- [API ç«¯é»](#api-ç«¯é»)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [ç’°å¢ƒè®Šæ•¸](#ç’°å¢ƒè®Šæ•¸)
- [å¸¸ç”¨æŒ‡ä»¤](#å¸¸ç”¨æŒ‡ä»¤)
- [æ¸¬è©¦](#æ¸¬è©¦)
- [å¸¸è¦‹å•é¡Œæ’æŸ¥](#å¸¸è¦‹å•é¡Œæ’æŸ¥)
- [å‚™ä»½èˆ‡é‚„åŸ](#å‚™ä»½èˆ‡é‚„åŸ)
- [ç”Ÿç”¢ç’°å¢ƒç¶­é‹æª¢æŸ¥æ¸…å–®](#ç”Ÿç”¢ç’°å¢ƒç¶­é‹æª¢æŸ¥æ¸…å–®)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)
- [é–‹ç™¼è¨ˆç•«](#é–‹ç™¼è¨ˆç•«)
- [æ–‡ä»¶ç´¢å¼•](#æ–‡ä»¶ç´¢å¼•)
- [æˆæ¬Š](#æˆæ¬Š)

---

## ç³»çµ±ç°¡ä»‹

UniHR æ¡ç”¨**é›™å±¤æ¶æ§‹**ï¼š

1. **Core å±¤**ï¼ˆå‹å‹•æ³• AI å¼•æ“ï¼‰â€”â€” å°ç£å‹å‹•æ³• RAG/QA ç³»çµ±ï¼ŒæŒçºŒå„ªåŒ–æ³•å¾‹å•ç­”å“è³ªã€‚
2. **SaaS å±¤**ï¼ˆæœ¬å°ˆæ¡ˆï¼‰â€”â€” å¤šç§Ÿæˆ¶ç®¡ç†å¹³å°ï¼Œè™•ç†å¸³è™Ÿã€æ¬Šé™ã€ä¼æ¥­çŸ¥è­˜åº«ã€å•ç­”å”èª¿ã€ç¨½æ ¸ã€ç”¨é‡è¿½è¹¤ã€‚

å“¡å·¥æå•æ™‚ï¼Œç³»çµ±åŒæ™‚æŸ¥è©¢ã€Œå…¬å¸å…§è¦ã€èˆ‡ã€Œå‹å‹•æ³• Coreã€ï¼Œåˆä½µç”¢å‡ºæœ€ä½³å›ç­”ã€‚

---

## æ ¸å¿ƒåŠŸèƒ½

### å¤šç§Ÿæˆ¶ç®¡ç†
- æ¯å®¶å…¬å¸æ“æœ‰ç¨ç«‹çš„ç©ºé–“ã€è³‡æ–™åº«è¨˜éŒ„èˆ‡å‘é‡ç´¢å¼•ï¼ˆpgvector per-tenant SQL éš”é›¢ï¼‰
- Row-Level Security + ä¸­é–“å±¤éš”é›¢ï¼Œç¢ºä¿ä¼æ¥­é–“è³‡æ–™é›¶äº¤å‰
- ç§Ÿæˆ¶é…é¡ç®¡ç†ï¼ˆå„²å­˜ç©ºé–“ã€æ–‡ä»¶æ•¸é‡ã€æ¯æœˆæŸ¥è©¢æ¬¡æ•¸ã€Token ç”¨é‡ä¸Šé™ï¼‰

### å¸³è™Ÿèˆ‡æ¬Šé™
- äº”ç´šè§’è‰²ï¼š`superadmin` â†’ `owner` â†’ `admin` â†’ `employee` â†’ `viewer`
- JWT èªè­‰ + SSOï¼ˆGoogle / Microsoft OAuth 2.0ï¼ŒEmail è‡ªå‹•è­˜åˆ¥çµ„ç¹”ï¼‰
- ä¸‰å±¤é€Ÿç‡é™åˆ¶ï¼ˆIP / ä½¿ç”¨è€… / ç§Ÿæˆ¶ï¼‰
- å‰ç«¯ RoleGuard è·¯ç”±å®ˆè¡› + å¾Œç«¯çµ±ä¸€ DI æ¬Šé™æª¢æŸ¥

### ä¼æ¥­çŸ¥è­˜åº«
- æ–‡ä»¶ä¸Šå‚³ â†’ è§£æ â†’ åˆ‡ç‰‡ â†’ å‘é‡åŒ– â†’ å­˜å…¥ pgvectorï¼ˆPostgreSQLï¼‰ï¼Œå…¨æµç¨‹èƒŒæ™¯è™•ç†ï¼ˆCeleryï¼‰
- æ”¯æ´ **23 ç¨®æª”æ¡ˆæ ¼å¼**ï¼ˆè©³è¦‹[æ–‡ä»¶è™•ç†å¼•æ“](#æ–‡ä»¶è™•ç†å¼•æ“)ï¼‰ï¼Œå« LlamaParse æ™ºæ…§è§£æ
- å“è³ªå ±å‘Šç³»çµ±ï¼šæ¯ä»½æ–‡ä»¶è‡ªå‹•è©•ä¼°è§£æå“è³ªï¼ˆexcellent / good / fair / poor / failedï¼‰

### AI å•ç­”ï¼ˆOrchestratorï¼‰
- æ··åˆæª¢ç´¢ï¼šèªæ„æœå°‹ + BM25 é—œéµå­—ï¼ˆjieba åˆ†è©ï¼‰+ RRF èåˆ + Voyage Rerank
- HyDE æŸ¥è©¢æ“´å±•ï¼šç”Ÿæˆå‡è¨­æ€§ HR æ–‡ä»¶ï¼Œæå‡èªæ„æª¢ç´¢å¬å›ç‡
- LLM ç­”æ¡ˆç”Ÿæˆï¼šOpenAI GPT-4o-mini æ ¹æ“šæª¢ç´¢å…§å®¹ç”Ÿæˆå›ç­”ï¼Œåƒ…å¼•ç”¨æä¾›è³‡æ–™ï¼Œä¸è‡ªè¡Œæé€ 
- åŒæ™‚æŸ¥è©¢å…¬å¸çŸ¥è­˜åº«èˆ‡ Core å‹å‹•æ³•ï¼Œåˆä½µå›ç­”ä¸¦æ¨™è¨»ä¾†æº
- Chunk å»é‡ï¼šper-document SHA256 é›œæ¹Šï¼Œé¿å…é‡è¤‡å‘é‡åŒ–
- å°è©±æ­·å²ä¿å­˜ï¼Œæ”¯æ´å¤šè¼ªè¿½å•
- **SSE ä¸²æµå›æ‡‰**ï¼šServer-Sent Events å¯¦æ™‚ä¸²æµï¼Œæ‰“å­—æ©Ÿæ•ˆæœå³æ™‚é¡¯ç¤º
- **Markdown æ¸²æŸ“**ï¼šæ”¯æ´ GFM è¡¨æ ¼ã€ç¨‹å¼ç¢¼é«˜äº®ï¼ˆrehype-highlightï¼‰ã€æ¸…å–®ã€æ¨™é¡Œç­‰æ ¼å¼
- **ä¾†æºå¼•ç”¨é¢æ¿**ï¼šå¯å±•é–‹çš„åƒè€ƒä¾†æºé¡¯ç¤ºï¼Œå€åˆ†å…¬å¸æ”¿ç­–èˆ‡å‹å‹•æ³•è¦ï¼Œå«ç›¸ä¼¼åº¦è©•åˆ†
- **ä½¿ç”¨è€…å›é¥‹ç³»çµ±**ï¼šğŸ‘ğŸ‘ è©•åˆ†æ©Ÿåˆ¶ï¼Œå«å›é¥‹åˆ†é¡èˆ‡æ„è¦‹æ¬„ä½ï¼Œç”¨æ–¼æŒçºŒå„ªåŒ–
- **å¾ŒçºŒå»ºè­°**ï¼šAI è‡ªå‹•ç”Ÿæˆç›¸é—œè¿½å•å»ºè­°ï¼Œå¼•å°ä½¿ç”¨è€…æ·±å…¥æ¢ç´¢
- **å°è©±ç®¡ç†**ï¼šæœå°‹æ­·å²å°è©±ã€åŒ¯å‡ºç‚º Markdownã€å¤šè¼ªä¸Šä¸‹æ–‡ç†è§£

### ç¨½æ ¸èˆ‡åˆè¦
- å®Œæ•´æ“ä½œæ—¥èªŒï¼šèª°å•äº†ä»€éº¼ã€æª¢ç´¢äº†å“ªäº›ä¾†æºã€å›ç­”äº†ä»€éº¼
- å¯è¿½æº¯çš„è­‰æ“šéˆï¼Œæ»¿è¶³ä¼æ¥­åˆè¦éœ€æ±‚

### ç”¨é‡è¿½è¹¤èˆ‡é…é¡
- æ¯ç§Ÿæˆ¶ Token / Query / å‘é‡åŒ–æˆæœ¬è¨˜éŒ„
- ç®¡ç†å“¡é…é¡ç®¡ç†ä»‹é¢ï¼Œè¶…é¡è‡ªå‹•å‘Šè­¦
- åˆ†æå„€è¡¨æ¿ï¼šä½¿ç”¨è¶¨å‹¢ã€ç†±é–€å•é¡Œã€éƒ¨é–€çµ±è¨ˆ

---

## ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend (React 19)                    â”‚
â”‚   Login Â· Chat Â· Documents Â· Admin Â· Analytics Â· Audit      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Backend API (FastAPI)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Auth   â”‚  â”‚   Chat   â”‚  â”‚  Documents â”‚  â”‚  Admin   â”‚  â”‚
â”‚  â”‚  + SSO   â”‚  â”‚Orchestr. â”‚  â”‚  + KB API  â”‚  â”‚ + Audit  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚              â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Service Layer                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Retriever   â”‚  â”‚ Doc Parser   â”‚  â”‚  Quota    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚Semantic+BM25 â”‚  â”‚ 23 Formats   â”‚  â”‚Enforcementâ”‚  â”‚    â”‚
â”‚  â”‚  â”‚+HyDE+Rerank  â”‚  â”‚+LlamaParse   â”‚  â”‚ +Alerts   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
     â”‚  pgvector     â”‚  â”‚   Celery   â”‚
     â”‚ (PostgreSQL)  â”‚  â”‚   Worker   â”‚
     â”‚  HNSW index   â”‚  â”‚ (bg tasks) â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚  â”‚    Redis      â”‚  â”‚ Voyage AI  â”‚  â”‚ OpenAI     â”‚
â”‚   15        â”‚  â”‚ 7 (queue+     â”‚  â”‚ Embedding  â”‚  â”‚ GPT-4o-miniâ”‚
â”‚ (primary DB)â”‚  â”‚    cache)     â”‚  â”‚ + Rerank   â”‚  â”‚ +LlamaParseâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“æ£§

### å¾Œç«¯

| é¡åˆ¥ | æŠ€è¡“ | ç‰ˆæœ¬ |
|------|------|------|
| Web æ¡†æ¶ | FastAPI | 0.109.2 |
| ORM | SQLAlchemy | 2.0.27 |
| è³‡æ–™åº«é·ç§» | Alembic | 1.13.1 |
| è³‡æ–™åº« | PostgreSQL | 15 |
| å¿«å– / è¨Šæ¯ä½‡åˆ— | Redis | 7 |
| èƒŒæ™¯ä»»å‹™ | Celery | 5.3.6 |
| å‘é‡è³‡æ–™åº« | pgvectorï¼ˆPostgreSQL æ“´å……ï¼ŒHNSW ç´¢å¼•ï¼‰ | 0.3.0+ |
| Embedding æ¨¡å‹ | Voyage AI (`voyage-4-lite`, 1024 ç¶­) | 0.3.7 |
| LLM | OpenAI GPT-4o-mini (`gpt-4o-mini`) | 1.12.0 |
| æ–‡ä»¶è§£æ | LlamaParseï¼ˆæ™ºæ…§è§£æ 10 ç¨®æ ¼å¼ï¼‰+ åŸç”Ÿè§£æå™¨é™ç´š | 0.6.0+ |
| ä¸­æ–‡åˆ†è© | jiebaï¼ˆBM25 è©ç´šåˆ†è©ï¼‰ | 0.42.1+ |
| èªè­‰ | JWT (python-jose) + OAuth 2.0 SSO | â€” |

### å‰ç«¯

| é¡åˆ¥ | æŠ€è¡“ | ç‰ˆæœ¬ |
|------|------|------|
| æ¡†æ¶ | React | 19.2 |
| èªè¨€ | TypeScript | 5.9 |
| å»ºæ§‹å·¥å…· | Vite | 7.2 |
| æ¨£å¼ | TailwindCSS | 4.1 |
| è·¯ç”± | React Router | 7.13 |
| åœ–è¡¨ | Recharts | 3.7 |
| HTTP | Axios | 1.13 |
| åœ–ç¤º | Lucide React | 0.563 |
| Markdown æ¸²æŸ“ | react-markdown + remark-gfm + rehype-highlight | 9.x |

### åŸºç¤è¨­æ–½

| é¡åˆ¥ | æŠ€è¡“ |
|------|------|
| å®¹å™¨åŒ– | Docker + Docker Composeï¼ˆé–‹ç™¼ç‰ˆ 5 å®¹å™¨ / ç”Ÿç”¢ç‰ˆ 12 å®¹å™¨ï¼‰ |
| éƒ¨ç½² | æ”¯æ´ Development / Staging / Production ä¸‰ç’°å¢ƒ |
| ç”Ÿç”¢å®‰å…¨ | å•Ÿå‹•é©—è­‰å™¨ï¼ˆconfig.py model_validatorï¼‰ã€å¼·åˆ¶å¯†ç¢¼æª¢æŸ¥ã€é root åŸ·è¡Œ |
| å¯†é‘°ç®¡ç† | è‡ªå‹•å¯†é‘°ç”Ÿæˆå·¥å…·ï¼ˆscripts/generate_secrets.pyï¼‰ |
| API ç‰ˆæœ¬ç®¡ç† | v1 (ç©©å®š) + v2 (æ–°åŠŸèƒ½)ï¼Œå« Deprecation Header |
| ç›£æ§ | Prometheus + Grafanaï¼ˆæŒ‡æ¨™æ”¶é›† + å„€éŒ¶æ¿ï¼‰ |
| é–˜é“ | Nginxï¼ˆåå‘ä»£ç† + SSL + å¤šåŸŸåè·¯ç”±ï¼‰ |

---

## æ–‡ä»¶è™•ç†å¼•æ“

æ··åˆè§£ææ¶æ§‹ï¼š**LlamaParse** ä½œç‚ºå„ªå…ˆè§£æå¼•æ“ï¼ˆæ”¯æ´ 10 ç¨®æ ¼å¼ï¼‰ï¼Œå“è³ªä¸è¶³æ™‚è‡ªå‹•é™ç´šè‡³åŸç”Ÿè§£æå™¨ã€‚åŸç”Ÿè§£æå™¨ç›´æ¥èª¿ç”¨åº•å±¤è§£æåº«ï¼Œç²¾ç°¡å¯æ§ã€‚

### æ”¯æ´æ ¼å¼ï¼ˆ23 ç¨®ï¼‰

| éšæ®µ | æ ¼å¼ | è§£æåº« | ç‰¹æ®Šèƒ½åŠ› |
|------|------|--------|----------|
| Phase 0 | PDFï¼ˆæ–‡å­—å‹ï¼‰ | LlamaParse â†’ `pypdf` | æ™ºæ…§è§£æ + é™ç´š |
| Phase 0 | DOCX | LlamaParse â†’ `python-docx` | æ¨™é¡Œå±¤ç´š + è¡¨æ ¼æå– |
| Phase 0 | DOC | LlamaParse â†’ `antiword` / `LibreOffice` | èˆŠæ ¼å¼é™ç´šè™•ç† |
| Phase 0 | TXT | stdlib + `chardet` | 6 ç¨®ç·¨ç¢¼è‡ªå‹•åµæ¸¬ + BOM æ¸…é™¤ |
| Phase 1 | PDFï¼ˆæƒæå‹ï¼‰ | LlamaParse â†’ `pytesseract` + `pdf2image` | ä¸­è‹±æ–‡ OCR |
| Phase 1 | PDFï¼ˆè¡¨æ ¼ï¼‰ | LlamaParse â†’ `pdfplumber` | çµæ§‹åŒ–è¡¨æ ¼æå– |
| Phase 1 | Excelï¼ˆ.xlsx/.xlsï¼‰ | LlamaParse â†’ `openpyxl` | å¤šå·¥ä½œè¡¨è§£æ |
| Phase 1 | CSV | stdlib | è‡ªå‹•åˆ†éš”ç¬¦è™Ÿåµæ¸¬ |
| Phase 1 | HTML | `BeautifulSoup` + `lxml` | script/style/nav æ¸…é™¤ã€XSS é˜²è­· |
| Phase 1 | Markdown | stdlib | æ¨™é¡Œçµæ§‹ä¿ç•™ |
| Phase 2 | RTF | LlamaParse â†’ `striprtf` | RTF æ§åˆ¶ç¢¼æ¸…é™¤ |
| Phase 2 | JSON | stdlib | çµæ§‹åŒ–è³‡æ–™ â†’ å¯è®€æ–‡å­— |
| Phase 2 | åœ–ç‰‡ï¼ˆJPG/PNG/TIFF/BMPï¼‰ | `pytesseract` + `Pillow` | OCR + è¾¨è­˜ä¿¡å¿ƒåº¦ |
| Phase 6 | PPT/PPTX | LlamaParse â†’ `python-pptx` | æŠ•å½±ç‰‡æ–‡å­— + å‚™è¨»æå– |
| Phase 6 | ç¶²é ï¼ˆURLï¼‰ | `trafilatura` | ç¶²é ä¸»è¦å…§å®¹æ“·å–ï¼Œå»é™¤å»£å‘Š/å°è¦½ |
| Phase 6 | æ‰‹å¯«æ–‡ä»¶ | LlamaParseï¼ˆå„ªå…ˆï¼‰+ `pytesseract` | æ‰‹å¯«é«” OCR + è¾¨è­˜ä¿¡å¿ƒåº¦ |

> LlamaParse æ”¯æ´æ ¼å¼ï¼šPDFã€DOCXã€DOCã€PPTXã€PPTã€XLSXã€XLSã€RTFã€EPUBã€HWPXã€‚è©² 10 ç¨®æ ¼å¼æœƒå„ªå…ˆä½¿ç”¨ LlamaParseï¼Œè‹¥å“è³ªåˆ†æ•¸ < 0.5 å‰‡è‡ªå‹•é™ç´šè‡³åŸç”Ÿè§£æå™¨ã€‚

### æ™ºæ…§åˆ‡ç‰‡å™¨ï¼ˆTextChunkerï¼‰

- **tiktoken ç²¾ç¢º Token è¨ˆç®—**ï¼ˆä½¿ç”¨ OpenAI tokenizerï¼Œéä¼°ç®—ï¼‰
- **ç« ç¯€é‚Šç•Œåµæ¸¬**ï¼šé‡åˆ° Markdown `#` æ¨™é¡Œè‡ªå‹•é–‹æ–° chunk
- **è¡¨æ ¼ä¿è­·**ï¼š`[è¡¨æ ¼ N]` å€å¡Šä¿æŒå®Œæ•´ä¸æ‹†æ•£
- **é‡ç–Šå€ä¿ç•™**ï¼šchunk é–“ä¿ç•™ä¸Šä¸‹æ–‡ï¼ˆé è¨­ 150 tokens overlapï¼‰
- **ç¢ç‰‡éæ¿¾**ï¼šè‡ªå‹•ä¸Ÿæ£„ < 30 tokens çš„ç¢ç‰‡

### å“è³ªå ±å‘Šç³»çµ±ï¼ˆQualityReportï¼‰

æ¯ä»½æ–‡ä»¶è§£æå¾Œè‡ªå‹•ç”¢å‡ºå“è³ªå ±å‘Šï¼š

| æ¬„ä½ | èªªæ˜ |
|------|------|
| `quality_score` | 0.0 ~ 1.0 ç¶œåˆåˆ†æ•¸ |
| `quality_level` | excellent / good / fair / poor / failed |
| `tables_detected` | åµæ¸¬åˆ°çš„è¡¨æ ¼æ•¸ |
| `ocr_used` | æ˜¯å¦ä½¿ç”¨ OCR |
| `ocr_confidence` | OCR è¾¨è­˜ä¿¡å¿ƒåº¦ |
| `encoding_detected` | åµæ¸¬åˆ°çš„ç·¨ç¢¼ |
| `warnings` / `errors` | è§£æè­¦å‘Šèˆ‡éŒ¯èª¤ |
| `suggestions` | æ”¹å–„å»ºè­° |
| `parse_engine` | ä½¿ç”¨çš„è§£æå¼•æ“ï¼ˆ`llamaparse` / `native`ï¼‰ |
| `handwriting_detected` | æ˜¯å¦åµæ¸¬åˆ°æ‰‹å¯«é«” |

### Benchmark è‡ªè©•çµæœ

62 é …æ¸¬è©¦ Ã— 7 ç¶­åº¦ï¼Œ**99.4/100 (A+)**ï¼š

```
A. è§£ææ­£ç¢ºæ€§    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100.0%  (A+)
B. é‚Šç•Œæ¢ä»¶      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100.0%  (A+)
C. åˆ‡ç‰‡å“è³ª      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  96.0%  (A+)
D. åˆ†è©å“è³ª      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100.0%  (A+)
E. æª¢ç´¢æ¶æ§‹      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100.0%  (A+)
F. æ•ˆèƒ½åŸºæº–      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100.0%  (A+)
G. ä¼æ¥­è¦†è“‹ç‡    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100.0%  (A+)
```

---

## é€²éšæª¢ç´¢å¼•æ“

è‡ªå»ºæ··åˆæª¢ç´¢ç³»çµ±ï¼ˆ`KnowledgeBaseRetriever`ï¼‰ï¼Œæ”¯æ´ä¸‰ç¨®æ¨¡å¼ï¼š

### æª¢ç´¢æ¨¡å¼

| æ¨¡å¼ | èªªæ˜ | é©ç”¨å ´æ™¯ |
|------|------|----------|
| `semantic` | pgvector å‘é‡é¤˜å¼¦ç›¸ä¼¼åº¦ï¼ˆcosine distanceï¼‰ | èªæ„ç†è§£ã€æ¦‚å¿µåŒ¹é… |
| `keyword` | BM25Okapi é—œéµå­—åŒ¹é… | ç²¾ç¢ºè©å½™ã€ç·¨è™Ÿã€æ³•æ¢æŸ¥è©¢ |
| `hybrid`ï¼ˆé è¨­ï¼‰ | èªæ„ + BM25 + RRF èåˆ | é€šç”¨å ´æ™¯ï¼Œå…¼é¡§èªæ„èˆ‡é—œéµå­— |

### ç®¡ç·šæµç¨‹

```
æŸ¥è©¢ â†’ HyDE æŸ¥è©¢æ“´å±•ï¼ˆèªæ„/æ··åˆæ¨¡å¼ï¼‰
       â†“
       â”¬â”€ èªæ„æª¢ç´¢ (pgvector + Voyage Embeddingï¼Œä½¿ç”¨ HyDE æ“´å±•æŸ¥è©¢)
       â””â”€ BM25 é—œéµå­—æª¢ç´¢ (jieba è©ç´šåˆ†è©ï¼Œä½¿ç”¨åŸå§‹æŸ¥è©¢)
              â†“
       RRF èåˆæ’åº (score = Î£ 1/(k + rank), k=60)
              â†“
       Voyage Rerank-2 é‡æ’åº
              â†“
       ç›¸ä¼¼åº¦é–¾å€¼éæ¿¾
              â†“
       çµæœï¼ˆå« content / score / source / metadataï¼‰
              â†“
       LLM ç­”æ¡ˆç”Ÿæˆï¼ˆOpenAI GPT-4o-miniï¼Œåƒ…å¼•ç”¨æª¢ç´¢å…§å®¹ï¼‰
```

### ç‰¹è‰²

- **jieba ä¸­æ–‡è©ç´šåˆ†è©**ï¼šç²¾æº–ä¸­æ–‡åˆ†è©ï¼ˆéé€å­—åˆ‡åˆ†ï¼‰ï¼Œæ”¯æ´ `NT$850,000` ç­‰æ ¼å¼
- **HyDE æŸ¥è©¢æ“´å±•**ï¼šè‡ªå‹•ç”Ÿæˆ 50-100 å­—å‡è¨­æ€§ HR æ–‡ä»¶ï¼Œæå‡èªæ„æª¢ç´¢å¬å›ç‡ï¼ˆåƒ…èªæ„/æ··åˆæ¨¡å¼å•Ÿç”¨ï¼‰
- **LLM ç­”æ¡ˆç”Ÿæˆ**ï¼šOpenAI GPT-4o-mini æ ¹æ“šæª¢ç´¢çµæœç”Ÿæˆå›ç­”ï¼Œåš´æ ¼é™åˆ¶åƒ…å¼•ç”¨æä¾›è³‡æ–™
- **Chunk å»é‡**ï¼šper-document SHA256 é›œæ¹Šï¼Œé¿å…é‡è¤‡å…§å®¹é€²å…¥å‘é‡åº«
- **Voyage Rerank**ï¼šä½¿ç”¨ `rerank-2` æ¨¡å‹å°å€™é¸çµæœé‡æ–°æ’åº
- **Redis æŸ¥è©¢å¿«å–**ï¼šSHA256 cache keyï¼Œ5 åˆ†é˜ TTLï¼Œæ–‡ä»¶è®Šæ›´æ™‚è‡ªå‹•å¤±æ•ˆ
- **metadata éæ¿¾**ï¼šæ”¯æ´ä¾ `filter_dict` SQL å±¤ç´šéæ¿¾ metadata æ¬„ä½
- **æ‰¹æ¬¡æœå°‹**ï¼š`batch_search()` æ”¯æ´å¤šæŸ¥è©¢ä¸¦è¡Œ
- **Graceful Degradation**ï¼šRedis / BM25 ä¸å¯ç”¨æ™‚è‡ªå‹•é™ç´š

---

## å¤šç§Ÿæˆ¶éš”é›¢

| å±¤ç´š | éš”é›¢æ–¹å¼ |
|------|----------|
| è³‡æ–™åº« | æ‰€æœ‰è¡¨å« `tenant_id`ï¼ŒJOIN/WHERE å¼·åˆ¶éæ¿¾ |
| å‘é‡è³‡æ–™åº« | pgvectorï¼ˆPostgreSQL æ“´å……ï¼‰ï¼Œé€é SQL `WHERE tenant_id` éš”é›¢ |
| æª”æ¡ˆå„²å­˜ | ä¸Šå‚³ç›®éŒ„ä»¥ `tenant_id` åˆ†éš” |
| API | ä¸­é–“å±¤å¾ JWT token æå– `tenant_id`ï¼Œæ³¨å…¥æ‰€æœ‰æŸ¥è©¢ |
| å¿«å– | Redis cache key åŒ…å« `tenant_id`ï¼Œä¸å¯è·¨ç§Ÿæˆ¶è®€å– |

---

## å‰ç«¯é é¢

| é é¢ | è·¯å¾‘ | èªªæ˜ |
|------|------|------|
| ç™»å…¥ | `/login` | JWT ç™»å…¥ + SSOï¼ˆEmail è‡ªå‹•è­˜åˆ¥çµ„ç¹”ï¼‰ |
| SSO å›èª¿ | `/login/callback` | OAuth 2.0 å›èª¿è™•ç† |
| AI å•ç­” | `/` | SSE ä¸²æµå°è©±ã€Markdown æ¸²æŸ“ã€ä¾†æºé¢æ¿ã€å›é¥‹æŒ‰éˆ•ã€å¾ŒçºŒå»ºè­°ã€å°è©±æœå°‹ã€åŒ¯å‡º Markdown |
| RAG å„€è¡¨æ¿ | `/rag-dashboard` | å°è©±é‡çµ±è¨ˆã€å»¶é² P50/P95ã€å›é¥‹åˆ†å¸ƒã€æ¯æ—¥è¶¨å‹¢åœ–è¡¨ï¼ˆç®¡ç†å“¡ï¼‰ |
| çŸ¥è­˜åº«ç®¡ç† | `/documents` | æ‹–æ”¾ä¸Šå‚³ã€ç‹€æ…‹è¿½è¹¤ã€éƒ¨é–€ç¯©é¸ |
| æˆ‘çš„ç”¨é‡ | `/my-usage` | å€‹äººä½¿ç”¨çµ±è¨ˆï¼ˆæ‰€æœ‰è§’è‰²ï¼‰ |
| å…¬å¸è¨­å®š | `/company` | ç§Ÿæˆ¶åŸºæœ¬è³‡è¨Šã€SSO è¨­å®š |
| éƒ¨é–€ç®¡ç† | `/departments` | æ¨¹ç‹€å±¤ç´šçµæ§‹ã€å¯æ”¶åˆç¯€é» |
| å“¡å·¥ç®¡ç† | `/admin` | ä½¿ç”¨è€…å¸³è™Ÿç®¡ç†ã€è§’è‰²æŒ‡æ´¾ |
| ç”¨é‡çµ±è¨ˆ | `/usage` | Token / æŸ¥è©¢ / å„²å­˜ç”¨é‡åœ–è¡¨ |
| é…é¡ç®¡ç† | `/admin/quota` | ç§Ÿæˆ¶é…é¡è¨­å®šèˆ‡å‘Šè­¦ï¼ˆè¶…ç´šç®¡ç†å“¡ï¼‰ |
| åˆ†æå„€è¡¨æ¿ | `/analytics` | ä½¿ç”¨è¶¨å‹¢ã€ç†±é–€å•é¡Œã€éƒ¨é–€çµ±è¨ˆ |
| ç¨½æ ¸æ—¥èªŒ | `/audit` | æ“ä½œç´€éŒ„æŸ¥è©¢ã€ç¯©é¸ã€åŒ¯å‡º |
| SSO è¨­å®š | `/sso-settings` | Google / Microsoft OAuth è¨­å®š |
| å“ç‰Œè¨­å®š | `/branding` | Logo / è‰²å½© / åç¨± + å³æ™‚é è¦½ |
| è¨‚é–±æ–¹æ¡ˆ | `/subscription` | æ–¹æ¡ˆå°æ¯” + Modal ç¢ºèªå‡ç´š |
| è‡ªè¨‚åŸŸå | `/custom-domains` | åŸŸå CRUD + DNS é©—è­‰å¼•å° |
| å€åŸŸè³‡è¨Š | `/regions` | è³‡æ–™é§ç•™å€åŸŸ + åˆè¦è³‡è¨Š |

---

## API ç«¯é»

### v1 APIï¼ˆ`/api/v1`ï¼‰

| æ¨¡çµ„ | è·¯ç”± | åŠŸèƒ½ |
|------|------|------|
| Auth | `/auth/login`, `/auth/register` | JWT ç™»å…¥ / è¨»å†Š |
| SSO | `/sso/google`, `/sso/microsoft` | OAuth 2.0 SSO |
| Chat | `/chat/send`, `/chat/stream`, `/chat/history`, `/chat/search` | AI å•ç­”ï¼ˆSSE ä¸²æµï¼‰ã€æ­·å²ã€æœå°‹ |
| Feedback | `/chat/feedback` | ä½¿ç”¨è€…å›é¥‹æäº¤ï¼ˆè©•åˆ† + åˆ†é¡ + æ„è¦‹ï¼‰ |
| RAG Dashboard | `/chat/rag-dashboard` | RAG è³ªé‡å„€è¡¨æ¿ï¼ˆå°è©±é‡ã€å»¶é²ã€å›é¥‹çµ±è¨ˆï¼‰ |
| Documents | `/documents/upload`, `/documents/{id}` | æ–‡ä»¶ä¸Šå‚³ / CRUD |
| KB | `/kb/search`, `/kb/stats` | çŸ¥è­˜åº«æª¢ç´¢ / çµ±è¨ˆ |
| Users | `/users/`, `/users/{id}` | ä½¿ç”¨è€…ç®¡ç† |
| Tenants | `/tenants/`, `/tenants/{id}` | ç§Ÿæˆ¶ç®¡ç† |
| Departments | `/departments/` | éƒ¨é–€ CRUD |
| Admin | `/admin/system/health`, `/admin/quota` | ç³»çµ±ç®¡ç† |
| Analytics | `/analytics/overview`, `/analytics/trends` | æ•¸æ“šåˆ†æ |
| Audit | `/audit/logs` | ç¨½æ ¸æ—¥èªŒ |
| Feature Flags | `/feature-flags/` | åŠŸèƒ½é–‹é—œ |

### v2 APIï¼ˆ`/api/v2`ï¼‰

æ–°ç‰ˆ APIï¼Œå‘ä¸‹ç›¸å®¹ v1ï¼Œå¢åŠ é€Ÿç‡é™åˆ¶ã€ç‰ˆæœ¬ deprecation headerã€‚

### Admin APIï¼ˆ`/admin`ï¼‰

ç¨ç«‹ç®¡ç†å¾®æœå‹™ï¼ˆport 8001ï¼‰ï¼Œé€é Service Token é©—è­‰ï¼Œæä¾›å¹³å°ç´šç®¡ç†åŠŸèƒ½ã€‚

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/admin/tenants` | GET | å…¨å¹³å°ç§Ÿæˆ¶åˆ—è¡¨ |
| `/admin/tenants/{id}` | GET/PUT | ç§Ÿæˆ¶è©³æƒ…èˆ‡æ›´æ–° |
| `/admin/tenants/{id}/quota` | PUT | é…é¡èª¿æ•´ |
| `/admin/analytics/overview` | GET | å¹³å°ç‡Ÿé‹æ¦‚è¦½ |
| `/admin/analytics/revenue` | GET | ç‡Ÿæ”¶åˆ†æ |
| `/admin/health` | GET | æœå‹™å¥åº·æª¢æŸ¥ |

### å¤šå€åŸŸ APIï¼ˆ`/api/v1/regions`ï¼‰

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/regions` | GET | å¯ç”¨å€åŸŸåˆ—è¡¨ |
| `/regions/current` | GET | ç•¶å‰ç§Ÿæˆ¶å€åŸŸ |
| `/regions/tenants/{id}/region` | GET/PUT | ç§Ÿæˆ¶å€åŸŸè¨­å®š |
| `/regions/tenants/{id}/data-residency` | GET | è³‡æ–™é§ç•™åˆè¦ |
| `/regions/compliance/summary` | GET | å…¨åŸŸåˆè¦æ‘˜è¦ |

### è¨‚é–±èˆ‡è‡ªè¨‚ç¶²åŸŸ

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/api/v1/subscription/plans` | GET | æ–¹æ¡ˆåˆ—è¡¨ |
| `/api/v1/subscription/current` | GET | ç•¶å‰è¨‚é–± |
| `/api/v1/subscription/change-plan` | POST | è®Šæ›´æ–¹æ¡ˆ |
| `/api/v1/custom-domains` | GET/POST | è‡ªè¨‚ç¶²åŸŸç®¡ç† |
| `/api/v1/custom-domains/{id}/verify` | POST | ç¶²åŸŸé©—è­‰ |
| `/api/v1/public/branding` | GET | å…¬é–‹å“ç‰Œè³‡è¨Š |

---

## ç”Ÿç”¢æ¶æ§‹

### CI/CD Pipelineï¼ˆGitHub Actionsï¼‰

```
Push to main
  â”œâ”€ ci.yml          â†’ Lint + Test + Buildï¼ˆè‡ªå‹•è§¸ç™¼ï¼‰
  â”œâ”€ deploy-staging  â†’ éƒ¨ç½²è‡³ Staging ç’°å¢ƒï¼ˆæ‰‹å‹•è§¸ç™¼ï¼‰
  â””â”€ deploy-production â†’ éƒ¨ç½²è‡³ Production ç’°å¢ƒï¼ˆæ‰‹å‹•è§¸ç™¼ï¼Œéœ€å¯©æ ¸ï¼‰
```

### Docker ç”Ÿç”¢éƒ¨ç½²

ç”Ÿç”¢ç’°å¢ƒé€é `docker-compose.prod.yml` ç·¨æ’ **12 å€‹å®¹å™¨**ï¼š

| å®¹å™¨ | èªªæ˜ | Port | å®‰å…¨ç‰¹æ€§ |
|------|------|------|----------|
| `web` | FastAPI å¾Œç«¯ï¼ˆuvicorn workers Ã— 4ï¼‰ | 8000 | ç„¡ --reloadï¼Œç„¡ volume mountï¼Œåƒ… uploads_data æŒä¹…åŒ– |
| `db` | PostgreSQL 15ï¼ˆpgvector + èª¿å„ªï¼‰ | â€” | ä¸å°å¤–æš´éœ²ï¼Œå¯†ç¢¼å¿…å¡«æª¢æŸ¥ï¼Œè³‡æºé™åˆ¶ |
| `redis` | Redis 7ï¼ˆå•Ÿç”¨ AOF + LRUï¼‰ | â€” | requirepass å¼·åˆ¶å¯†ç¢¼ï¼Œä¸å°å¤–æš´éœ² |
| `worker` | Celery èƒŒæ™¯ä»»å‹™ Worker | â€” | max-tasks-per-child=200 é˜²è¨˜æ†¶é«”æ´©æ¼ |
| `frontend` | React SPAï¼ˆNginx éœæ…‹æœå‹™ï¼‰ | 80 | â€” |
| `admin-api` | Admin å¾®æœå‹™ | 8001 | Service Token é©—è­‰ |
| `admin-frontend` | Admin å‰ç«¯ SPA | 80 | â€” |
| `admin-redis` | Admin ç¨ç«‹ Redis | â€” | ç¨ç«‹å¯†ç¢¼ï¼Œéš”é›¢å¿«å– |
| `gateway` | Nginx åå‘ä»£ç†é–˜é“ | 80/443 | çµ±ä¸€å…¥å£ï¼Œæ”¯æ´ SSL |
| `prometheus` | ç›£æ§æŒ‡æ¨™æ”¶é›† | 9090 | åƒ…å…§éƒ¨è¨ªå• |
| `grafana` | ç›£æ§å„€éŒ¶æ¿ | 3000 | å¼·åˆ¶å¯†ç¢¼ï¼Œç¦æ­¢è¨»å†Š |

**é—œéµå®‰å…¨ç‰¹æ€§**ï¼š
- âœ… æ‰€æœ‰å®¹å™¨ `restart: always`
- âœ… å®Œæ•´å¥åº·æª¢æŸ¥ï¼ˆ`healthcheck`ï¼‰
- âœ… è³‡æºé™åˆ¶ï¼ˆCPU / Memory limitsï¼‰
- âœ… æ—¥èªŒè¼ªæ›¿ï¼ˆjson-file + max-size 50mï¼‰
- âœ… é root ä½¿ç”¨è€…åŸ·è¡Œï¼ˆDockerfile ä¸­å»ºç«‹ `unihr` ä½¿ç”¨è€…ï¼‰
- âœ… è³‡æ–™åº«/Redis ä¸å°å¤–æš´éœ²åŸ 
- âœ… ç’°å¢ƒè®Šæ•¸é€é `.env.production` ç®¡ç†ï¼Œæ•æ„Ÿå€¼å¿…å¡«æª¢æŸ¥ï¼ˆ`:?` èªæ³•ï¼‰
- âœ… `app/config.py` å…§å»ºå•Ÿå‹•é©—è­‰å™¨ï¼Œç”Ÿç”¢ç’°å¢ƒè‡ªå‹•é˜»æ“‹å¼±å¯†é‘°

### Nginx Gateway å¤šåŸŸåè·¯ç”±

```
app.unihr.com       â†’ frontend + backend API
admin.unihr.com     â†’ admin-frontend + admin-api
grafana.unihr.com   â†’ Grafana å„€éŒ¶æ¿
*.unihr.com         â†’ ç§Ÿæˆ¶è‡ªè¨‚å­ç¶²åŸŸ
```

### å¤šå€åŸŸéƒ¨ç½²

æ”¯æ´ 4 å€‹éƒ¨ç½²å€åŸŸï¼Œæ¯å€‹å€åŸŸç¨ç«‹åŸºç¤è¨­æ–½ï¼š

| å€åŸŸä»£ç¢¼ | å€åŸŸåç¨± | è³‡æ–™é§ç•™åˆè¦ |
|----------|----------|-------------|
| `ap` | äºå¤ªï¼ˆå°ç£ï¼‰ | PDPA |
| `us` | åŒ—ç¾ï¼ˆç¾åœ‹ï¼‰ | SOC 2 |
| `eu` | æ­æ´²ï¼ˆå¾·åœ‹ï¼‰ | GDPR |
| `jp` | æ—¥æœ¬ï¼ˆæ±äº¬ï¼‰ | APPI |

ä½¿ç”¨ `docker-compose.region.yml` è¦†è“‹é€²è¡Œå€åŸŸåŒ–éƒ¨ç½²ã€‚

### ç›£æ§å †ç–Š

```
FastAPI metrics â†’ Prometheus (scrape) â†’ Grafana (dashboard)
                                     â†’ Alertmanager (alerts â†’ Slack/Email)
```

- **Prometheus**ï¼šæ¯ 15 ç§’æŠ“å– `/metrics` ç«¯é»
- **Grafana**ï¼šé é…ç½®è³‡æ–™ä¾†æºèˆ‡å„€éŒ¶æ¿ï¼ˆè‡ªå‹• provisioningï¼‰
- **Alertmanager**ï¼šè‡ªè¨‚å‘Šè­¦è¦å‰‡ï¼ˆCPUã€è¨˜æ†¶é«”ã€å›æ‡‰æ™‚é–“ã€éŒ¯èª¤ç‡ï¼‰

---

## å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- Docker & Docker Compose
- Node.js 18+ï¼ˆå‰ç«¯é–‹ç™¼ç”¨ï¼‰
- Python 3.11+ï¼ˆå¾Œç«¯é–‹ç™¼ç”¨ï¼‰

### ä¸€éµå•Ÿå‹•ï¼ˆDocker é–‹ç™¼ç’°å¢ƒï¼‰

```bash
# 1. è¤‡è£½ç’°å¢ƒè®Šæ•¸
cp .env.example .env

# 2. ç·¨è¼¯ .env å¡«å…¥å¿…è¦çš„ API keys
# å¿…å¡«é …ç›®ï¼š
#   - OPENAI_API_KEY=sk-proj-...    # https://platform.openai.com/api-keys
#   - VOYAGE_API_KEY=pa-...          # https://www.voyageai.com/
#   - LLAMAPARSE_API_KEY=llx-...     # https://cloud.llamaindex.ai/
# è©³ç´°å–å¾—æ–¹å¼è«‹åƒé–±ã€Œå¸¸è¦‹å•é¡Œæ’æŸ¥ã€â†’ã€ŒAPI Keys å–å¾—æ–¹å¼ã€ç« ç¯€

# 3. å•Ÿå‹•æ‰€æœ‰æœå‹™
make dev

# 4. ç­‰å¾…æœå‹™å•Ÿå‹•ï¼ˆç´„ 30 ç§’ï¼‰
# é¦–æ¬¡å•Ÿå‹•éœ€è¦ä¸‹è¼‰ Docker æ˜ åƒä¸¦å»ºç«‹è³‡æ–™åº«

# 5. åˆå§‹åŒ–è³‡æ–™åº«
make migrate

# 6. å»ºç«‹é è¨­ç®¡ç†å“¡å¸³è™Ÿ
docker-compose exec web python scripts/initial_data.py
# é è¨­å¸³å¯†ï¼šadmin@example.com / admin123

# 7. ä¸Šå‚³æ¸¬è©¦æ–‡ä»¶ï¼ˆé¸ç”¨ï¼‰
docker-compose exec web python scripts/batch_upload.py

# 8. åŸ·è¡Œæ¸¬è©¦å¥—ä»¶é©—è­‰ï¼ˆé¸ç”¨ï¼‰
docker-compose exec web python scripts/run_tests.py
```

å•Ÿå‹•å¾Œï¼š
- **å¾Œç«¯ API**ï¼šhttp://localhost:8000
- **API æ–‡ä»¶**ï¼šhttp://localhost:8000/docsï¼ˆSwagger UI äº’å‹•å¼æ–‡ä»¶ï¼‰
- **å‰ç«¯ä»‹é¢**ï¼šhttp://localhost:3001ï¼ˆä½¿ç”¨ admin@example.com / admin123 ç™»å…¥ï¼‰
- **Admin API**ï¼šhttp://localhost:8001
- **Admin æ–‡ä»¶**ï¼šhttp://localhost:8001/docs

**é¦–æ¬¡ä½¿ç”¨å»ºè­°**ï¼š
1. å‰å¾€ http://localhost:3001 ç™»å…¥å¾Œå°
2. ä¸Šå‚³ 1-2 ä»½æ¸¬è©¦æ–‡ä»¶ï¼ˆPDF / DOCX / TXTï¼‰
3. ç­‰å¾…æ–‡ä»¶è™•ç†å®Œæˆï¼ˆæŸ¥çœ‹ã€ŒçŸ¥è­˜åº«ç®¡ç†ã€é é¢ç‹€æ…‹ï¼‰
4. å‰å¾€ã€ŒAI å•ç­”ã€é é¢æ¸¬è©¦æå•

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

#### 1. ç”Ÿæˆå¯†é‘°èˆ‡å¯†ç¢¼

```bash
# ä¸€éµç”Ÿæˆæ‰€æœ‰å¯†é‘°ï¼ˆSECRET_KEYã€DB å¯†ç¢¼ã€Redis å¯†ç¢¼ç­‰ï¼‰
python scripts/generate_secrets.py

# æˆ–è‡ªå‹•å¯«å…¥ .env.production
cp .env.production.example .env.production
python scripts/generate_secrets.py --output .env.production
```

`generate_secrets.py` æœƒè‡ªå‹•ç”¢ç”Ÿï¼š
- `SECRET_KEY`ï¼ˆ48 å­—å…ƒï¼‰
- `POSTGRES_PASSWORD`ï¼ˆ32 å­—å…ƒï¼‰
- `REDIS_PASSWORD`ï¼ˆ24 å­—å…ƒï¼‰
- `ADMIN_REDIS_PASSWORD`ï¼ˆ24 å­—å…ƒï¼‰
- `GRAFANA_PASSWORD`ï¼ˆ16 å­—å…ƒï¼‰

#### 2. é…ç½®ç’°å¢ƒè®Šæ•¸

ç·¨è¼¯ `.env.production`ï¼Œè£œå……ä»¥ä¸‹å¿…å¡«é …ç›®ï¼š

| è®Šæ•¸ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `FIRST_SUPERUSER_EMAIL` | é¦–ä½è¶…ç´šç®¡ç†å“¡ Email | `admin@yourcompany.com` |
| `FIRST_SUPERUSER_PASSWORD` | è¶…ç´šç®¡ç†å“¡å¯†ç¢¼ï¼ˆâ‰¥ 12 å­—å…ƒï¼‰ | `YourStrongP@ssw0rd!` |
| `OPENAI_API_KEY` | OpenAI API Key | `sk-proj-...` |
| `VOYAGE_API_KEY` | Voyage AI API Key | `pa-...` |
| `LLAMAPARSE_API_KEY` | LlamaParse API Key | `llx-...` |
| `BACKEND_CORS_ORIGINS` | å…è¨±çš„å‰ç«¯åŸŸå | `https://app.yourcompany.com` |
| `CORE_API_URL` | Core å‹å‹•æ³• API | `https://core.yourcompany.com` |

> âš ï¸ **å®‰å…¨æé†’**ï¼š
> - `SECRET_KEY` å¿…é ˆ â‰¥ 32 å­—å…ƒéš¨æ©Ÿå­—ä¸²
> - æ‰€æœ‰å¯†ç¢¼ç¦ç”¨é è¨­å€¼ï¼ˆ`postgres`ã€`admin123` ç­‰ï¼‰
> - **config.py æœƒåœ¨ `APP_ENV=production` æ™‚è‡ªå‹•æª¢æŸ¥ï¼Œè‹¥ä½¿ç”¨ä¸å®‰å…¨é…ç½®å°‡ç›´æ¥é˜»æ“‹å•Ÿå‹•**

#### 3. å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ

```bash
# å•Ÿå‹•æ‰€æœ‰å®¹å™¨ï¼ˆweb / db / redis / worker / frontend / nginx / prometheus / grafana ç­‰ 12 å€‹ï¼‰
docker compose -f docker-compose.prod.yml up -d --build

# ç­‰å¾…æœå‹™å•Ÿå‹•ï¼ˆç´„ 15 ç§’ï¼‰
sleep 15

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
docker compose -f docker-compose.prod.yml exec web alembic upgrade head

# å»ºç«‹é¦–ä½è¶…ç´šç®¡ç†å“¡ï¼ˆè®€å– .env.production é…ç½®ï¼‰
docker compose -f docker-compose.prod.yml exec web python scripts/initial_data.py
```

#### 4. é©—è­‰éƒ¨ç½²

```bash
# æª¢æŸ¥æ‰€æœ‰å®¹å™¨é‹è¡Œç‹€æ…‹
docker compose -f docker-compose.prod.yml ps

# å¥åº·æª¢æŸ¥
curl https://app.yourcompany.com/health
curl https://admin.yourcompany.com/health

# æŸ¥çœ‹æ—¥èªŒ
docker compose -f docker-compose.prod.yml logs -f web
```

ç”Ÿç”¢ç’°å¢ƒå…¥å£ï¼š
- **å‰å°**ï¼šhttps://app.yourcompany.com
- **å¾Œå°**ï¼šhttps://admin.yourcompany.com
- **ç›£æ§**ï¼šhttps://grafana.yourcompany.com

#### 5. å®‰å…¨æª¢æŸ¥æ¸…å–®

éƒ¨ç½²å‰è«‹ç¢ºèªï¼š

| é …ç›® | ç‹€æ…‹ |
|------|------|
| âœ… SECRET_KEY å·²æ”¹ç‚º â‰¥ 32 å­—å…ƒéš¨æ©Ÿå­—ä¸² | â¬œ |
| âœ… è³‡æ–™åº«å¯†ç¢¼éé è¨­å€¼ `postgres` | â¬œ |
| âœ… Redis å¯†ç¢¼å·²è¨­å®š | â¬œ |
| âœ… è¶…ç´šç®¡ç†å“¡å¸³å¯†å·²æ”¹ç‚ºçœŸå¯¦å€¼ | â¬œ |
| âœ… CORS åªå…è¨±æŒ‡å®šåŸŸå | â¬œ |
| âœ… SSL æ†‘è­‰å·²é…ç½®ï¼ˆnginx/certs/ï¼‰ | â¬œ |
| âœ… æ‰€æœ‰å¤–éƒ¨ API Key å·²å¡«å…¥ | â¬œ |
| âœ… Grafana ç®¡ç†å“¡å¯†ç¢¼å·²ä¿®æ”¹ | â¬œ |
| âœ… é˜²ç«ç‰†åªé–‹æ”¾ 80/443 | â¬œ |
| âœ… PostgreSQL / Redis æœªå°å¤–æš´éœ² | â¬œ |

### æœ¬åœ°é–‹ç™¼ï¼ˆä¸ä½¿ç”¨ Dockerï¼‰

```bash
# å¾Œç«¯
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8000

# å‰ç«¯
cd frontend
npm install
npm run dev

# Admin å¾®æœå‹™
cd admin_service
uvicorn main:app --reload --port 8001
```

---

## ç’°å¢ƒè®Šæ•¸

### å¿…å¡«è®Šæ•¸ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

| è®Šæ•¸ | èªªæ˜ | å¿…å¡« | é è¨­ |
|------|------|------|------|
| `SECRET_KEY` | JWT ç°½åå¯†é‘°ï¼ˆâ‰¥ 32 å­—å…ƒï¼‰ | âœ… | â€” |
| `FIRST_SUPERUSER_EMAIL` | é¦–ä½è¶…ç´šç®¡ç†å“¡ Email | âœ… | `admin@example.com` |
| `FIRST_SUPERUSER_PASSWORD` | è¶…ç´šç®¡ç†å“¡å¯†ç¢¼ï¼ˆâ‰¥ 12 å­—å…ƒï¼‰ | âœ… | `admin123` |
| `POSTGRES_PASSWORD` | PostgreSQL å¯†ç¢¼ | âœ… | `postgres` |
| `REDIS_PASSWORD` | Redis å¯†ç¢¼ | âœ… | â€” |
| `ADMIN_REDIS_PASSWORD` | Admin Redis å¯†ç¢¼ | âœ… | â€” |
| `OPENAI_API_KEY` | OpenAI API Key | âœ… | â€” |
| `VOYAGE_API_KEY` | Voyage AIï¼ˆEmbedding + Rerankï¼‰ | âœ… | â€” |
| `GRAFANA_PASSWORD` | Grafana ç®¡ç†å“¡å¯†ç¢¼ | âœ… | `admin` |

### AI / LLM è¨­å®š

| è®Šæ•¸ | èªªæ˜ | å¿…å¡« | é è¨­ |
|------|------|------|------|
| `OPENAI_MODEL` | OpenAI æ¨¡å‹åç¨± | â€” | `gpt-4o-mini` |
| `OPENAI_TEMPERATURE` | LLM ç”Ÿæˆæº«åº¦ | â€” | `0.3` |
| `OPENAI_MAX_TOKENS` | LLM æœ€å¤§è¼¸å‡º Token | â€” | `1500` |
| `LLAMAPARSE_API_KEY` | LlamaParse æ–‡ä»¶è§£æ API Key | â€” | â€” |
| `LLAMAPARSE_ENABLED` | å•Ÿç”¨ LlamaParse è§£æ | â€” | `true` |
| `EMBEDDING_DIMENSION` | å‘é‡ç¶­åº¦ | â€” | `1024` |

### è³‡æ–™åº«è¨­å®š

| è®Šæ•¸ | èªªæ˜ | å¿…å¡« | é è¨­ |
|------|------|------|------|
| `POSTGRES_SERVER` | PostgreSQL ä¸»æ©Ÿ | â€” | `localhost` |
| `POSTGRES_USER` | è³‡æ–™åº«ä½¿ç”¨è€… | â€” | `postgres` |
| `POSTGRES_DB` | è³‡æ–™åº«åç¨± | â€” | `unihr_saas` |
| `REDIS_HOST` | Redis ä¸»æ©Ÿ | â€” | `localhost` |
| `CELERY_BROKER_URL` | Celery Broker URL | â€” | `redis://redis:6379/0` |
| `CELERY_RESULT_BACKEND` | Celery çµæœå¾Œç«¯ | â€” | `redis://redis:6379/0` |

### å¤–éƒ¨æœå‹™è¨­å®š

| è®Šæ•¸ | èªªæ˜ | å¿…å¡« | é è¨­ |
|------|------|------|------|
| `CORE_API_URL` | Core å‹å‹•æ³• API ä½å€ | â€” | `http://localhost:5000` |
| `GOOGLE_CLIENT_ID` | Google SSO | â€” | â€” |
| `GOOGLE_CLIENT_SECRET` | Google SSO Secret | â€” | â€” |
| `MICROSOFT_CLIENT_ID` | Microsoft SSO | â€” | â€” |
| `MICROSOFT_CLIENT_SECRET` | Microsoft SSO Secret | â€” | â€” |
| `SSO_DEFAULT_REDIRECT_URI` | SSO å›èª¿ URI | â€” | `http://localhost:3001/login/callback` |

### æª¢ç´¢èˆ‡å¿«å–è¨­å®š

| è®Šæ•¸ | èªªæ˜ | å¿…å¡« | é è¨­ |
|------|------|------|------|
| `RETRIEVAL_MODE` | æª¢ç´¢æ¨¡å¼ï¼ˆsemantic / keyword / hybridï¼‰ | â€” | `hybrid` |
| `RETRIEVAL_RERANK` | å•Ÿç”¨é‡æ’åº | â€” | `true` |
| `RETRIEVAL_CACHE_TTL` | å¿«å– TTLï¼ˆç§’ï¼‰ | â€” | `300` |
| `RETRIEVAL_TOP_K` | é è¨­è¿”å›æ•¸é‡ | â€” | `5` |

### å®‰å…¨èˆ‡é€Ÿç‡é™åˆ¶

| è®Šæ•¸ | èªªæ˜ | å¿…å¡« | é è¨­ |
|------|------|------|------|
| `RATE_LIMIT_ENABLED` | å•Ÿç”¨é€Ÿç‡é™åˆ¶ | â€” | `true` |
| `RATE_LIMIT_GLOBAL_PER_IP` | IP é€Ÿç‡ï¼ˆreq/minï¼‰ | â€” | `200` |
| `RATE_LIMIT_PER_USER` | ä½¿ç”¨è€…é€Ÿç‡ï¼ˆreq/minï¼‰ | â€” | `60` |
| `RATE_LIMIT_PER_TENANT` | ç§Ÿæˆ¶é€Ÿç‡ï¼ˆreq/minï¼‰ | â€” | `300` |
| `RATE_LIMIT_CHAT_PER_USER` | èŠå¤©é€Ÿç‡ï¼ˆreq/minï¼‰ | â€” | `20` |
| `ADMIN_IP_WHITELIST_ENABLED` | å•Ÿç”¨ Admin IP ç™½åå–® | â€” | `false` |
| `ADMIN_IP_WHITELIST` | å…è¨±çš„ IP / CIDR | â€” | `127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16` |

### å¾®æœå‹™èˆ‡å€åŸŸè¨­å®š

| è®Šæ•¸ | èªªæ˜ | å¿…å¡« | é è¨­ |
|------|------|------|------|
| `ADMIN_SERVICE_TOKEN` | Admin å¾®æœå‹™ Token | âœ…ï¼ˆç”Ÿç”¢ï¼‰ | â€” |
| `DEPLOY_REGION` | éƒ¨ç½²å€åŸŸä»£ç¢¼ | â€” | `ap` |
| `GRAFANA_ROOT_URL` | Grafana å¤–éƒ¨ URL | â€” | `https://grafana.unihr.com` |
| `BACKEND_CORS_ORIGINS` | å…è¨±çš„ CORS ä¾†æºï¼ˆé€—è™Ÿåˆ†éš”ï¼‰ | â€” | `http://localhost:3000,http://localhost:3001` |

å®Œæ•´åˆ—è¡¨åƒè¦‹ï¼š
- é–‹ç™¼ï¼š[.env.example](.env.example)
- Stagingï¼š[.env.staging.example](.env.staging.example) 
- ç”Ÿç”¢ï¼š[.env.production.example](.env.production.example)

> âš ï¸ **ç”Ÿç”¢ç’°å¢ƒå®‰å…¨æç¤º**ï¼š  
> `app/config.py` å« `model_validator`ï¼Œåœ¨ `APP_ENV=production` æˆ– `staging` æ™‚æœƒè‡ªå‹•æª¢æŸ¥ï¼š
> - `SECRET_KEY` ä¸å¯ç‚ºå·²çŸ¥å¼±é è¨­å€¼æˆ– < 32 å­—å…ƒ â†’ **ç›´æ¥ raise ValueError é˜»æ“‹å•Ÿå‹•**
> - `POSTGRES_PASSWORD` ä¸å¯ç‚º `"postgres"` â†’ **ç›´æ¥ raise ValueError é˜»æ“‹å•Ÿå‹•**
> - `FIRST_SUPERUSER_EMAIL` ä»ç‚º `"admin@example.com"` â†’ **ç™¼å‡º UserWarning**
> - `FIRST_SUPERUSER_PASSWORD` ä»ç‚º `"admin123"` â†’ **ç™¼å‡º UserWarning**

---

## å¸¸ç”¨æŒ‡ä»¤

```bash
# === é–‹ç™¼ç’°å¢ƒ ===
make dev                # å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
make down               # åœæ­¢æ‰€æœ‰æœå‹™
make down-v             # åœæ­¢ä¸¦æ¸…é™¤è³‡æ–™
make logs               # æŸ¥çœ‹æ‰€æœ‰æ—¥èªŒ
make logs-web           # æŸ¥çœ‹å¾Œç«¯æ—¥èªŒ
make logs-worker        # æŸ¥çœ‹ Worker æ—¥èªŒ
make migrate            # åŸ·è¡Œè³‡æ–™åº«é·ç§»
make migrate-create     # å»ºç«‹æ–°é·ç§»æª”
make shell              # é€²å…¥å¾Œç«¯å®¹å™¨ shell
make db-shell           # é€²å…¥ PostgreSQL shell
make redis-cli          # é€²å…¥ Redis CLI
make status             # æŸ¥çœ‹æœå‹™ç‹€æ…‹
make health             # å¥åº·æª¢æŸ¥
make build              # é‡å»ºæ‰€æœ‰å®¹å™¨

# === ç”Ÿç”¢å¯†é‘°ç”Ÿæˆ ===
# ç”Ÿæˆæ‰€æœ‰å¯†é‘°ï¼ˆé¡¯ç¤ºåœ¨çµ‚ç«¯ï¼‰
python scripts/generate_secrets.py

# è‡ªå‹•å¯«å…¥ .env.production
python scripts/generate_secrets.py --output .env.production

# === éƒ¨ç½² ===
make staging            # å•Ÿå‹• Staging ç’°å¢ƒ
make prod               # å•Ÿå‹• Production ç’°å¢ƒï¼ˆ12 å®¹å™¨ï¼‰

# æ‰‹å‹•å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ
docker compose -f docker-compose.prod.yml up -d --build
docker compose -f docker-compose.prod.yml exec web alembic upgrade head
docker compose -f docker-compose.prod.yml exec web python scripts/initial_data.py
```

---

## æ¸¬è©¦

### å¾Œç«¯å–®å…ƒæ¸¬è©¦

```bash
# åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦ï¼ˆ52 é …ï¼‰
python -m pytest tests/ -v

# æ–‡ä»¶å¼•æ“æ¸¬è©¦ï¼ˆ90 é …ï¼‰
python tests/test_document_engine.py

# æ–‡ä»¶å¼•æ“ Benchmarkï¼ˆ62 é …ï¼Œå«æ•ˆèƒ½åŸºæº–ï¼‰
python tests/benchmark_document_engine.py
```

### è² è¼‰æ¸¬è©¦

```bash
# Locust è² è¼‰æ¸¬è©¦
cd tests/load
locust -f locustfile.py --host http://localhost:8000

# k6 è² è¼‰æ¸¬è©¦
k6 run tests/load/k6_load_test.js
```

### æ¸¬è©¦æ¶µè“‹ç¯„åœ

| æ¸¬è©¦æª”æ¡ˆ | æ¸¬è©¦é …ç›® | æ•¸é‡ |
|----------|----------|------|
| `test_tenant_isolation.py` | ç§Ÿæˆ¶è³‡æ–™éš”é›¢ | 6 |
| `test_permissions.py` | è§’è‰²æ¬Šé™æ§åˆ¶ | 8 |
| `test_usage_tracking.py` | ç”¨é‡è¿½è¹¤ | 5 |
| `test_e2e_chat.py` | ç«¯å°ç«¯å•ç­” | 6 |
| `test_company_admin.py` | å…¬å¸ç®¡ç† | 5 |
| `test_quota_management.py` | é…é¡ç®¡ç† | 6 |
| `test_analytics_security.py` | åˆ†æå®‰å…¨æ€§ | 5 |
| `test_sso_security.py` | SSO å®‰å…¨æ€§ | 5 |
| `test_feature_flags_logic.py` | åŠŸèƒ½é–‹é—œ | 6 |
| `test_document_engine.py` | æ–‡ä»¶è™•ç†å¼•æ“ | 90 |
| `benchmark_document_engine.py` | èƒ½åŠ›è‡ªè©• Benchmark | 62 |
| `tests/load/locustfile.py` | HTTP è² è¼‰æ¸¬è©¦ | â€” |
| `tests/load/k6_load_test.js` | k6 æ•ˆèƒ½æ¸¬è©¦ | â€” |

---

## å¸¸è¦‹å•é¡Œæ’æŸ¥

### å®¹å™¨ç„¡æ³•å•Ÿå‹•

**å•é¡Œ**ï¼š`docker-compose up -d` å¤±æ•—

**æ’æŸ¥æ­¥é©Ÿ**ï¼š
```powershell
# 1. æª¢æŸ¥å®¹å™¨ç‹€æ…‹
docker-compose ps

# 2. æŸ¥çœ‹å¤±æ•—å®¹å™¨çš„æ—¥èªŒ
docker-compose logs web
docker-compose logs db

# 3. æª¢æŸ¥åŸ è™Ÿä½”ç”¨
netstat -ano | findstr "8000"
netstat -ano | findstr "5432"

# 4. æ¸…é™¤èˆŠå®¹å™¨é‡æ–°å•Ÿå‹•
docker-compose down -v
docker-compose up -d --build
```

**å¸¸è¦‹åŸå› **ï¼š
- åŸ è™Ÿè¢«ä½”ç”¨ï¼ˆ8000 / 5432 / 6379ï¼‰
- `.env` æª”æ¡ˆæ ¼å¼éŒ¯èª¤æˆ–ç¼ºå°‘å¿…å¡«æ¬„ä½
- Docker Desktop æœªå•Ÿå‹•æˆ–è¨˜æ†¶é«”ä¸è¶³

### ç”Ÿç”¢ç’°å¢ƒå•Ÿå‹•å¤±æ•—

**å•é¡Œ**ï¼š`APP_ENV=production` æ™‚å› ç‚ºå®‰å…¨æª¢æŸ¥ç„¡æ³•å•Ÿå‹•

**éŒ¯èª¤è¨Šæ¯**ï¼š
```
ValueError: SECRET_KEY is insecure ('change_tâ€¦'). Set a strong random key (â‰¥ 32 chars)
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```powershell
# 1. ç”Ÿæˆå®‰å…¨å¯†é‘°
python scripts/generate_secrets.py --output .env.production

# 2. æ‰‹å‹•å¡«å…¥ API Keys èˆ‡ç®¡ç†å“¡è³‡è¨Š
# ç·¨è¼¯ .env.productionï¼Œç¢ºä¿ä»¥ä¸‹æ¬„ä½å·²å¡«å…¥ï¼š
# - SECRET_KEYï¼ˆâ‰¥ 32 å­—å…ƒï¼‰
# - POSTGRES_PASSWORDï¼ˆé 'postgres'ï¼‰
# - FIRST_SUPERUSER_EMAILï¼ˆçœŸå¯¦ emailï¼‰
# - FIRST_SUPERUSER_PASSWORDï¼ˆå¼·å¯†ç¢¼ï¼‰
# - OPENAI_API_KEY
# - VOYAGE_API_KEY
# - LLAMAPARSE_API_KEY

# 3. é‡æ–°å•Ÿå‹•
docker compose -f docker-compose.prod.yml up -d
```

### API Keys å–å¾—æ–¹å¼

| æœå‹™ | ç”¨é€” | å–å¾—ç¶²å€ | è²»ç”¨ |
|------|------|----------|------|
| OpenAI | LLM ç”Ÿæˆ + HyDE æŸ¥è©¢æ“´å±• | https://platform.openai.com/api-keys | ä¾ç”¨é‡è¨ˆè²» |
| Voyage AI | Embedding (voyage-4-lite) + Rerank (rerank-2) | https://www.voyageai.com/ | å‰ 100M tokens å…è²» |
| LlamaParse | é«˜å“è³ªæ–‡ä»¶è§£æï¼ˆPDF/DOCX/PPTï¼‰ | https://cloud.llamaindex.ai/ | å‰ 1000 é å…è²» |

**OpenAI è¨­å®š**ï¼š
1. è¨»å†Š OpenAI å¸³è™Ÿï¼Œå‰å¾€ [API Keys](https://platform.openai.com/api-keys)
2. é»æ“Šã€ŒCreate new secret keyã€
3. è¤‡è£½ `sk-proj-...` é–‹é ­çš„ key
4. è²¼å…¥ `.env` çš„ `OPENAI_API_KEY`

**Voyage AI è¨­å®š**ï¼š
1. è¨»å†Š Voyage AI å¸³è™Ÿï¼Œå‰å¾€ [Dashboard](https://www.voyageai.com/)
2. è¤‡è£½ API Keyï¼ˆ`pa-...` é–‹é ­ï¼‰
3. è²¼å…¥ `.env` çš„ `VOYAGE_API_KEY`

**LlamaParse è¨­å®š**ï¼š
1. è¨»å†Š LlamaIndex å¸³è™Ÿï¼Œå‰å¾€ [LlamaCloud](https://cloud.llamaindex.ai/)
2. è¤‡è£½ API Keyï¼ˆ`llx-...` é–‹é ­ï¼‰
3. è²¼å…¥ `.env` çš„ `LLAMAPARSE_API_KEY`

### è³‡æ–™åº«é€£ç·šå¤±æ•—

**å•é¡Œ**ï¼š`FATAL: password authentication failed for user "postgres"`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```powershell
# 1. æª¢æŸ¥ .env ä¸­çš„è³‡æ–™åº«å¯†ç¢¼
Get-Content .env | Select-String "POSTGRES"

# 2. æ¸…é™¤èˆŠçš„ volume ä¸¦é‡å»º
docker-compose down -v
docker volume prune -f
docker-compose up -d

# 3. ç­‰å¾…è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼ˆç´„ 10 ç§’ï¼‰
Start-Sleep -Seconds 10

# 4. åŸ·è¡Œé·ç§»
docker-compose exec web alembic upgrade head
```

### æ¸¬è©¦å¥—ä»¶å¤±æ•—

**å•é¡Œ**ï¼š`scripts/run_tests.py` æŸäº›å•é¡Œç­”ä¸å‡ºä¾†æˆ–åˆ†æ•¸ä½

**æ’æŸ¥æ­¥é©Ÿ**ï¼š
```powershell
# 1. ç¢ºèªæ‰€æœ‰æ–‡ä»¶å·²ä¸Šå‚³
docker-compose exec web python scripts/batch_upload.py

# 2. æª¢æŸ¥ Redis å¿«å–æ˜¯å¦éœ€è¦æ¸…é™¤
docker-compose exec redis redis-cli FLUSHDB

# 3. é‡å•Ÿæœå‹™ç¢ºä¿ç¨‹å¼ç¢¼å·²é‡æ–°è¼‰å…¥ï¼ˆWindows Docker ä¸æœƒè‡ªå‹• reloadï¼‰
docker-compose restart web worker

# 4. åŸ·è¡Œå–®ä¸€å•é¡Œ debug
docker-compose exec web python scripts/debug_scores.py E1

# 5. æª¢æŸ¥çµæ§‹åŒ–ç­”æ¡ˆ handler
docker-compose exec web python scripts/test_structured.py
```

### Chunk å»é‡å•é¡Œ

**å•é¡Œ**ï¼šé‡è¤‡ä¸Šå‚³ç›¸åŒæ–‡ä»¶å¾Œï¼Œç¬¬äºŒä»½æ–‡ä»¶æ²’æœ‰ chunks

**åŸå› **ï¼š`document_tasks.py` çš„ chunk å»é‡é‚è¼¯éŒ¯èª¤ï¼ˆtenant-scoped è€Œé document-scopedï¼‰

**å·²ä¿®å¾©**ï¼šPhase 8 å·²å°‡å»é‡æ”¹ç‚º per-document SHA256 æª¢æŸ¥

**é©—è­‰ä¿®å¾©**ï¼š
```python
# æª¢æŸ¥ document_tasks.py ç¬¬ 130 è¡Œå·¦å³
# æ‡‰è©²æ˜¯ï¼šDChunk.document_id == UUID(document_id)
# è€Œéï¼šDChunk.tenant_id == UUID(tenant_id)
```

### å‰ç«¯ç„¡æ³•é€£ç·šå¾Œç«¯

**å•é¡Œ**ï¼šå‰ç«¯é¡¯ç¤º `Network Error` æˆ– CORS éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```powershell
# 1. æª¢æŸ¥å¾Œç«¯æ˜¯å¦é‹è¡Œ
curl http://localhost:8000/health

# 2. æª¢æŸ¥ CORS è¨­å®š
docker-compose exec web python -c "from app.config import settings; print(settings.BACKEND_CORS_ORIGINS)"

# 3. æ›´æ–° .env çš„ CORS è¨­å®š
# BACKEND_CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:3002

# 4. é‡å•Ÿå®¹å™¨
docker-compose restart web
```

### Celery Worker è™•ç†æ–‡ä»¶å¡ä½

**å•é¡Œ**ï¼šä¸Šå‚³æ–‡ä»¶å¾Œä¸€ç›´é¡¯ç¤º `processing`

**æ’æŸ¥æ­¥é©Ÿ**ï¼š
```powershell
# 1. æª¢æŸ¥ worker æ—¥èªŒ
docker-compose logs worker --tail=50

# 2. æª¢æŸ¥ä»»å‹™ä½‡åˆ—
docker-compose exec redis redis-cli LLEN celery

# 3. æª¢æŸ¥æ˜¯å¦æœ‰ä»»å‹™å¤±æ•—
docker-compose exec web python -c "from app.celery_app import celery_app; print(celery_app.control.inspect().active())"

# 4. é‡å•Ÿ worker
docker-compose restart worker
```

---

## å‚™ä»½èˆ‡é‚„åŸ

### PostgreSQL è³‡æ–™åº«å‚™ä»½

```powershell
# é–‹ç™¼ç’°å¢ƒ
docker-compose exec db pg_dump -U postgres unihr_saas > backup_$(Get-Date -Format "yyyyMMdd_HHmmss").sql

# ç”Ÿç”¢ç’°å¢ƒ
docker compose -f docker-compose.prod.yml exec db pg_dump -U unihr unihr_saas > backup_prod_$(Get-Date -Format "yyyyMMdd_HHmmss").sql

# è‡ªå‹•å‚™ä»½è…³æœ¬ï¼ˆå·²æä¾›ï¼‰
./scripts/backup.sh
```

### è³‡æ–™åº«é‚„åŸ

```powershell
# 1. åœæ­¢æœå‹™
docker-compose down

# 2. é‡æ–°å•Ÿå‹•è³‡æ–™åº«
docker-compose up -d db

# 3. é‚„åŸå‚™ä»½
Get-Content backup_20260211_120000.sql | docker-compose exec -T db psql -U postgres unihr_saas

# 4. å•Ÿå‹•å…¶ä»–æœå‹™
docker-compose up -d
```

### ä¸Šå‚³æª”æ¡ˆå‚™ä»½

```powershell
# å‚™ä»½ä¸Šå‚³ç›®éŒ„
Compress-Archive -Path uploads -DestinationPath uploads_backup_$(Get-Date -Format "yyyyMMdd").zip

# é‚„åŸ
Expand-Archive -Path uploads_backup_20260211.zip -DestinationPath uploads -Force
```

### å®Œæ•´ç³»çµ±å‚™ä»½

```powershell
# 1. è³‡æ–™åº«å‚™ä»½
docker-compose exec db pg_dump -U postgres unihr_saas > db_backup.sql

# 2. ä¸Šå‚³æª”æ¡ˆå‚™ä»½
Compress-Archive -Path uploads -DestinationPath uploads_backup.zip

# 3. ç’°å¢ƒè®Šæ•¸å‚™ä»½ï¼ˆæ³¨æ„ï¼šä¸è¦æäº¤åˆ° Gitï¼‰
Copy-Item .env .env.backup

# 4. Redis è³‡æ–™å‚™ä»½ï¼ˆé¸ç”¨ï¼‰
docker-compose exec redis redis-cli SAVE
Copy-Item redis_data/dump.rdb redis_backup.rdb
```

---

## ç”Ÿç”¢ç’°å¢ƒç¶­é‹æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰æª¢æŸ¥

- [ ] `.env.production` æ‰€æœ‰å¿…å¡«æ¬„ä½å·²å¡«å…¥
- [ ] SECRET_KEY å¼·åº¦ â‰¥ 32 å­—å…ƒ
- [ ] è³‡æ–™åº«å¯†ç¢¼éé è¨­å€¼
- [ ] è¶…ç´šç®¡ç†å“¡å¸³å¯†å·²ä¿®æ”¹
- [ ] æ‰€æœ‰ API Keys å·²å–å¾—ä¸¦å¡«å…¥
- [ ] CORS åªå…è¨±æŒ‡å®šåŸŸå
- [ ] SSL æ†‘è­‰å·²æº–å‚™ï¼ˆnginx/certs/ï¼‰
- [ ] é˜²ç«ç‰†è¦å‰‡å·²è¨­å®šï¼ˆåƒ…é–‹æ”¾ 80/443ï¼‰
- [ ] PostgreSQL / Redis æœªå°å¤–æš´éœ²

### éƒ¨ç½²å¾Œé©—è­‰

```powershell
# 1. æª¢æŸ¥æ‰€æœ‰å®¹å™¨é‹è¡Œç‹€æ…‹
docker compose -f docker-compose.prod.yml ps

# 2. å¥åº·æª¢æŸ¥
curl https://app.yourcompany.com/health
curl https://admin.yourcompany.com/health

# 3. æ¸¬è©¦ç™»å…¥
# å‰å¾€ https://app.yourcompany.com/login
# ä½¿ç”¨ FIRST_SUPERUSER_EMAIL / PASSWORD ç™»å…¥

# 4. æª¢æŸ¥è³‡æ–™åº«é·ç§»
docker compose -f docker-compose.prod.yml exec web alembic current

# 5. æª¢æŸ¥ Celery Worker
docker compose -f docker-compose.prod.yml logs worker --tail=20

# 6. æª¢æŸ¥ç›£æ§
# å‰å¾€ https://grafana.yourcompany.com
# ä½¿ç”¨ GRAFANA_PASSWORD ç™»å…¥
```

### æ¯æ—¥æª¢æŸ¥

- [ ] æª¢æŸ¥å®¹å™¨ç‹€æ…‹ï¼š`docker compose -f docker-compose.prod.yml ps`
- [ ] æª¢æŸ¥ç£ç¢Ÿç©ºé–“ï¼š`df -h`
- [ ] æª¢æŸ¥éŒ¯èª¤æ—¥èªŒï¼š`docker compose -f docker-compose.prod.yml logs --tail=100 | Select-String "ERROR"`
- [ ] æª¢æŸ¥ Grafana å‘Šè­¦
- [ ] åŸ·è¡Œè³‡æ–™åº«å‚™ä»½

### æ¯é€±æª¢æŸ¥

- [ ] æª¢æŸ¥ PostgreSQL æ•ˆèƒ½ï¼š`docker compose -f docker-compose.prod.yml exec db psql -U unihr -c "SELECT * FROM pg_stat_activity;"`
- [ ] æª¢æŸ¥ Redis è¨˜æ†¶é«”ä½¿ç”¨ï¼š`docker compose -f docker-compose.prod.yml exec redis redis-cli INFO memory`
- [ ] æª¢æŸ¥ç£ç¢Ÿ I/Oï¼šæŸ¥çœ‹ Grafana å„€éŒ¶æ¿
- [ ] å¯©æŸ¥ç¨½æ ¸æ—¥èªŒ
- [ ] æ¸¬è©¦å‚™ä»½é‚„åŸæµç¨‹

### æ¯æœˆæª¢æŸ¥

- [ ] æ›´æ–° Docker æ˜ åƒï¼š`docker compose -f docker-compose.prod.yml pull && docker compose -f docker-compose.prod.yml up -d`
- [ ] æª¢æŸ¥å®‰å…¨æ€§æ›´æ–°
- [ ] å¯©æŸ¥ç”¨é‡çµ±è¨ˆèˆ‡é…é¡
- [ ] åŸ·è¡Œè² è¼‰æ¸¬è©¦
- [ ] å¯©æŸ¥ SSL æ†‘è­‰æœ‰æ•ˆæœŸ

---

## ç›®éŒ„çµæ§‹

```
unihr-saas/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                    # FastAPI å…¥å£
â”‚   â”œâ”€â”€ config.py                  # ç’°å¢ƒè¨­å®šï¼ˆPydantic Settingsï¼‰
â”‚   â”œâ”€â”€ celery_app.py              # Celery è¨­å®š
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ v1/endpoints/          # v1 API ç«¯é»
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py            #   èªè­‰
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py            #   AI å•ç­”
â”‚   â”‚   â”‚   â”œâ”€â”€ documents.py       #   æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ kb.py              #   çŸ¥è­˜åº«æª¢ç´¢
â”‚   â”‚   â”‚   â”œâ”€â”€ users.py           #   ä½¿ç”¨è€…ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ tenants.py         #   ç§Ÿæˆ¶ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.py           #   ç³»çµ±ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.py       #   æ•¸æ“šåˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ audit.py           #   ç¨½æ ¸æ—¥èªŒ
â”‚   â”‚   â”‚   â”œâ”€â”€ departments.py     #   éƒ¨é–€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ sso.py             #   SSO ç«¯é»
â”‚   â”‚   â”‚   â”œâ”€â”€ feature_flags.py   #   åŠŸèƒ½é–‹é—œ
â”‚   â”‚   â”‚   â”œâ”€â”€ tenant_admin.py    #   ç§Ÿæˆ¶ç®¡ç†å“¡
â”‚   â”‚   â”‚   â”œâ”€â”€ subscription.py    #   è¨‚é–±æ–¹æ¡ˆç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ custom_domains.py  #   è‡ªè¨‚ç¶²åŸŸ
â”‚   â”‚   â”‚   â”œâ”€â”€ regions.py         #   å¤šå€åŸŸç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ public.py          #   å…¬é–‹å“ç‰Œç«¯é»
â”‚   â”‚   â””â”€â”€ v2/                    # v2 APIï¼ˆå‘ä¸‹ç›¸å®¹ v1ï¼‰
â”‚   â”œâ”€â”€ models/                    # SQLAlchemy æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ tenant.py              #   ç§Ÿæˆ¶ + é…é¡ + æ–¹æ¡ˆ + å“ç‰Œ
â”‚   â”‚   â”œâ”€â”€ user.py                #   ä½¿ç”¨è€…
â”‚   â”‚   â”œâ”€â”€ document.py            #   æ–‡ä»¶ + åˆ‡ç‰‡
â”‚   â”‚   â”œâ”€â”€ chat.py                #   å°è©± + è¨Šæ¯
â”‚   â”‚   â”œâ”€â”€ feedback.py            # â˜… ä½¿ç”¨è€…å›é¥‹ï¼ˆrating 1=ğŸ‘, 2=ğŸ‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ audit.py               #   ç¨½æ ¸è¨˜éŒ„
â”‚   â”‚   â”œâ”€â”€ permission.py          #   æ¬Šé™
â”‚   â”‚   â”œâ”€â”€ sso_config.py          #   SSO è¨­å®š
â”‚   â”‚   â”œâ”€â”€ feature_flag.py        #   åŠŸèƒ½é–‹é—œ
â”‚   â”‚   â””â”€â”€ custom_domain.py       #   è‡ªè¨‚ç¶²åŸŸ
â”‚   â”œâ”€â”€ schemas/                   # Pydantic Schemas
â”‚   â”œâ”€â”€ crud/                      # è³‡æ–™å­˜å–å±¤
â”‚   â”œâ”€â”€ services/                  # æ ¸å¿ƒæ¥­å‹™é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ document_parser.py     #   å¤šæ ¼å¼è§£æå¼•æ“ï¼ˆLlamaParse + åŸç”Ÿï¼Œ~1320 è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ kb_retrieval.py        #   é€²éšæª¢ç´¢å¼•æ“ï¼ˆjieba + HyDEï¼Œ~595 è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ chat_orchestrator.py   #   å•ç­”å”èª¿å™¨ï¼ˆLLM ç”Ÿæˆ + é™ç´šï¼‰
â”‚   â”‚   â”œâ”€â”€ core_client.py         #   Core API å®¢æˆ¶ç«¯
â”‚   â”‚   â”œâ”€â”€ quota_enforcement.py   #   é…é¡åŸ·è¡Œ
â”‚   â”‚   â”œâ”€â”€ quota_alerts.py        #   é…é¡å‘Šè­¦
â”‚   â”‚   â”œâ”€â”€ security_isolation.py  #   å®‰å…¨éš”é›¢
â”‚   â”‚   â””â”€â”€ feature_flags.py       #   åŠŸèƒ½é–‹é—œ
â”‚   â”œâ”€â”€ tasks/                     # Celery èƒŒæ™¯ä»»å‹™
â”‚   â”‚   â””â”€â”€ document_tasks.py      #   æ–‡ä»¶è™•ç†ä»»å‹™
â”‚   â”œâ”€â”€ middleware/                 # ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ rate_limit.py          #   é€Ÿç‡é™åˆ¶
â”‚   â”‚   â””â”€â”€ versioning.py          #   API ç‰ˆæœ¬ç®¡ç†
â”‚   â””â”€â”€ db/                        # è³‡æ–™åº«é€£ç·š
â”œâ”€â”€ admin_service/                 # â˜… Admin ç¨ç«‹å¾®æœå‹™
â”‚   â”œâ”€â”€ __init__.py                #   FastAPI app + Service Token ä¸­é–“ä»¶
â”‚   â”œâ”€â”€ main.py                    #   å…¥å£ï¼ˆport 8001ï¼‰
â”‚   â”œâ”€â”€ db.py                      #   è³‡æ–™åº«é€£ç·š
â”‚   â”œâ”€â”€ cache.py                   #   Redis å¿«å–
â”‚   â””â”€â”€ Dockerfile                 #   Docker æ˜ åƒ
â”œâ”€â”€ frontend/                      # ç§Ÿæˆ¶å‰ç«¯ï¼ˆReact 19ï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.tsx                # è·¯ç”±è¨­å®š
â”‚       â”œâ”€â”€ api.ts                 # API å®¢æˆ¶ç«¯
â”‚       â”œâ”€â”€ auth.tsx               # èªè­‰ Context
â”‚       â”œâ”€â”€ types.ts               # TypeScript å‹åˆ¥
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ Layout.tsx         # å´é‚Šæ¬„å°è¦½ Layout
â”‚       â”‚   â””â”€â”€ chat/              # â˜… Phase 7 å°è©±çµ„ä»¶
â”‚       â”‚       â”œâ”€â”€ MarkdownRenderer.tsx   # Markdown æ¸²æŸ“ï¼ˆGFM + ç¨‹å¼ç¢¼é«˜äº®ï¼‰
â”‚       â”‚       â”œâ”€â”€ SourcePanel.tsx        # ä¾†æºå¼•ç”¨é¢æ¿ï¼ˆå¯å±•é–‹ï¼‰
â”‚       â”‚       â”œâ”€â”€ FeedbackButtons.tsx    # å›é¥‹æŒ‰éˆ•ï¼ˆğŸ‘ğŸ‘ï¼‰
â”‚       â”‚       â”œâ”€â”€ FollowUpSuggestions.tsx # å¾ŒçºŒå»ºè­°é¡¯ç¤º
â”‚       â”‚       â””â”€â”€ TypingIndicator.tsx    # æ‰“å­—æŒ‡ç¤ºå™¨
â”‚       â””â”€â”€ pages/                 # é é¢å…ƒä»¶ï¼ˆ18 é ï¼‰
â”‚           â”œâ”€â”€ LoginPage.tsx       #   ç™»å…¥ + SSO Email è‡ªå‹•è­˜åˆ¥
â”‚           â”œâ”€â”€ ChatPage.tsx        # â˜… SSE ä¸²æµå°è©± + Markdown + ä¾†æº + å›é¥‹ + æœå°‹ + åŒ¯å‡º
â”‚           â”œâ”€â”€ RAGDashboardPage.tsx # â˜… RAG è³ªé‡å„€è¡¨æ¿ï¼ˆP50/P95 å»¶é²ã€å›é¥‹çµ±è¨ˆï¼‰
â”‚           â”œâ”€â”€ DocumentsPage.tsx    #   æ–‡ä»¶ç®¡ç† + éƒ¨é–€ç¯©é¸
â”‚           â”œâ”€â”€ MyUsagePage.tsx      # â˜… å€‹äººç”¨é‡çµ±è¨ˆ
â”‚           â”œâ”€â”€ CompanyPage.tsx
â”‚           â”œâ”€â”€ AdminPage.tsx
â”‚           â”œâ”€â”€ AdminQuotaPage.tsx
â”‚           â”œâ”€â”€ AnalyticsPage.tsx
â”‚           â”œâ”€â”€ AuditLogsPage.tsx
â”‚           â”œâ”€â”€ DepartmentsPage.tsx  #   æ¨¹ç‹€å±¤ç´šçµæ§‹
â”‚           â”œâ”€â”€ UsagePage.tsx
â”‚           â”œâ”€â”€ SSOSettingsPage.tsx
â”‚           â”œâ”€â”€ SSOCallbackPage.tsx
â”‚           â”œâ”€â”€ BrandingPage.tsx     #   å“ç‰Œè¨­å®š + å³æ™‚é è¦½
â”‚           â”œâ”€â”€ SubscriptionPage.tsx #   è¨‚é–± + Modal å‡ç´šç¢ºèª
â”‚           â”œâ”€â”€ CustomDomainsPage.tsx # â˜… è‡ªè¨‚åŸŸå CRUD
â”‚           â””â”€â”€ RegionsPage.tsx     # â˜… å€åŸŸèˆ‡è³‡æ–™é§ç•™
â”œâ”€â”€ admin-frontend/                # â˜… ç®¡ç†å“¡å¾Œå°å‰ç«¯
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.tsx                # å¾Œå°è·¯ç”±
â”‚       â”œâ”€â”€ api.ts                 # Admin API å®¢æˆ¶ç«¯
â”‚       â”œâ”€â”€ auth.tsx               # ç®¡ç†å“¡èªè­‰
â”‚       â””â”€â”€ pages/                 # å¾Œå°é é¢
â”‚           â”œâ”€â”€ LoginPage.tsx
â”‚           â”œâ”€â”€ AdminPage.tsx
â”‚           â”œâ”€â”€ AdminQuotaPage.tsx
â”‚           â””â”€â”€ AnalyticsPage.tsx
â”œâ”€â”€ nginx/                         # â˜… Nginx é–˜é“è¨­å®š
â”‚   â”œâ”€â”€ gateway.conf               #   å¤šåŸŸååå‘ä»£ç†ï¼ˆapp/admin/grafanaï¼‰
â”‚   â”œâ”€â”€ admin.conf                 #   Admin ç«™é»è¨­å®š
â”‚   â””â”€â”€ client.conf                #   ç§Ÿæˆ¶ç«™é»è¨­å®š
â”œâ”€â”€ monitoring/                    # â˜… ç›£æ§å †ç–Š
â”‚   â”œâ”€â”€ prometheus.yml             #   Prometheus æŠ“å–è¨­å®š
â”‚   â”œâ”€â”€ alert_rules.yml            #   å‘Šè­¦è¦å‰‡
â”‚   â””â”€â”€ grafana/
â”‚       â””â”€â”€ provisioning/          #   Grafana è‡ªå‹•é…ç½®
â”œâ”€â”€ configs/                       # â˜… è³‡æ–™åº«èª¿å„ª
â”‚   â””â”€â”€ postgresql-tuning.conf     #   PostgreSQL æ•ˆèƒ½èª¿å„ªåƒæ•¸
â”œâ”€â”€ .github/workflows/             # â˜… CI/CD Pipeline
â”‚   â”œâ”€â”€ ci.yml                     #   æŒçºŒæ•´åˆï¼ˆLint + Test + Buildï¼‰
â”‚   â”œâ”€â”€ deploy-staging.yml         #   Staging éƒ¨ç½²
â”‚   â””â”€â”€ deploy-production.yml      #   Production éƒ¨ç½²
â”œâ”€â”€ tests/                         # æ¸¬è©¦å¥—ä»¶
â”‚   â”œâ”€â”€ test_*.py                  #   å–®å…ƒæ¸¬è©¦ï¼ˆ52 é …ï¼‰
â”‚   â”œâ”€â”€ benchmark_document_engine.py  # æ•ˆèƒ½åŸºæº–æ¸¬è©¦
â”‚   â””â”€â”€ load/                      # â˜… è² è¼‰æ¸¬è©¦
â”‚       â”œâ”€â”€ locustfile.py          #   Locust è² è¼‰æ¸¬è©¦
â”‚       â”œâ”€â”€ k6_load_test.js        #   k6 æ•ˆèƒ½æ¸¬è©¦
â”‚       â””â”€â”€ results/               #   æ¸¬è©¦çµæœ
â”œâ”€â”€ alembic/                       # è³‡æ–™åº«é·ç§»
â”‚   â””â”€â”€ versions/                  #   é·ç§»ç‰ˆæœ¬éˆ
â”‚       â””â”€â”€ t7_5_feedback.py       # â˜… Phase 7: chat_feedbacks è¡¨ï¼ˆè©•åˆ†+åˆ†é¡+æ„è¦‹ï¼‰
â”œâ”€â”€ scripts/                       # å·¥å…·è…³æœ¬
â”‚   â”œâ”€â”€ create_tables.py           #   è³‡æ–™è¡¨å»ºç«‹
â”‚   â”œâ”€â”€ create_test_users.py       #   æ¸¬è©¦å¸³è™Ÿå»ºç«‹
â”‚   â”œâ”€â”€ generate_secrets.py        # â˜… ç”Ÿç”¢å¯†é‘°ç”Ÿæˆå·¥å…·ï¼ˆSECRET_KEY / POSTGRES_PASSWORD / REDIS_PASSWORD ç­‰ï¼‰
â”‚   â””â”€â”€ initial_data.py            #   åˆå§‹åŒ–è³‡æ–™ï¼ˆè®€å– FIRST_SUPERUSER_EMAIL/PASSWORDï¼‰
â”œâ”€â”€ docs/                          # å°ˆæ¡ˆæ–‡ä»¶
â”‚   â”œâ”€â”€ PROJECT_PLAN.md            #   å®Œæ•´ç”¢å“è¦æ ¼æ›¸ï¼ˆ1500+ è¡Œï¼‰
â”‚   â”œâ”€â”€ API_GUIDE.md               #   API ä½¿ç”¨æŒ‡å—
â”‚   â”œâ”€â”€ API_DEVELOPER_GUIDE.md     # â˜… API é–‹ç™¼è€…æ•´åˆæŒ‡å—
â”‚   â”œâ”€â”€ USER_MANUAL.md             # â˜… ä½¿ç”¨è€…æ“ä½œæ‰‹å†Š
â”‚   â”œâ”€â”€ OPS_SOP.md                 # â˜… ç¶­é‹ SOP
â”‚   â”œâ”€â”€ MULTI_REGION.md            # â˜… å¤šå€åŸŸéƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ UX_FLOW_REVIEW.md          # â˜… UX æµç¨‹å…¨è§’è‰²æª¢è¦–å ±å‘Š
â”‚   â”œâ”€â”€ PHASE2_TEST_REPORT.md      #   Phase 2 æ¸¬è©¦å ±å‘Š
â”‚   â”œâ”€â”€ PHASE3_TEST_REPORT.md      #   Phase 3 æ¸¬è©¦å ±å‘Š
â”‚   â””â”€â”€ PHASE7_UPGRADE_PROPOSAL.md # â˜… Phase 7 å‡ç´šææ¡ˆï¼ˆå°è©±é«”é©—å‡ç´šï¼‰
â”œâ”€â”€ docker-compose.yml             # é–‹ç™¼ç’°å¢ƒ
â”œâ”€â”€ docker-compose.staging.yml     # Staging è¦†è“‹
â”œâ”€â”€ docker-compose.prod.yml        # â˜… ç”Ÿç”¢ç’°å¢ƒï¼ˆ12 å®¹å™¨ï¼‰
â”œâ”€â”€ docker-compose.region.yml      # â˜… å¤šå€åŸŸè¦†è“‹
â”œâ”€â”€ docker-compose.production.yml  # Production è¦†è“‹
â”œâ”€â”€ .env.example                   # é–‹ç™¼ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ .env.staging.example           # â˜… Staging ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ .env.production.example        # â˜… Production ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ .env.development.example       # â˜… é–‹ç™¼ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ Dockerfile                     # å¾Œç«¯æ˜ åƒ
â”œâ”€â”€ Makefile                       # å¸¸ç”¨æŒ‡ä»¤
â”œâ”€â”€ requirements.txt               # Python ä¾è³´
â””â”€â”€ requirements-test.txt          # â˜… æ¸¬è©¦ä¾è³´
```

> â˜… æ¨™è¨˜ç‚º Phase 4/5 æ–°å¢é …ç›®

---

## é–‹ç™¼è¨ˆç•«

| éšæ®µ | å…§å®¹ | ç‹€æ…‹ |
|------|------|------|
| Phase 1 | åŸºç¤å»ºè¨­ï¼šå¤šç§Ÿæˆ¶ + èªè­‰ + æ–‡ä»¶ç®¡ç·š + AI å•ç­” | âœ… å®Œæˆ |
| Phase 2 | å®‰å…¨å¼·åŒ–ï¼šSSO + é€Ÿç‡é™åˆ¶ + API ç‰ˆæœ¬ + åŠŸèƒ½æ——æ¨™ | âœ… å®Œæˆ |
| Phase 3 | ç®¡ç†åŠŸèƒ½ï¼šé…é¡ + åˆ†æ + å‰ç«¯é é¢ | âœ… å®Œæˆ |
| Phase 3+ | æ–‡ä»¶å¼•æ“å‡ç´šï¼š19 æ ¼å¼ + é€²éšæª¢ç´¢ + æ··åˆæœå°‹ | âœ… å®Œæˆ |
| Phase 4 | ç”Ÿç”¢åŒ–ï¼šå‰å¾Œå°åˆ†é›¢ + CI/CD + ç™½æ¨™ + ç›£æ§ + å®‰å…¨ç¨½æ ¸ + å¾®æœå‹™åŒ– + å¤šå€åŸŸï¼ˆ22 ä»»å‹™ï¼‰ | âœ… å®Œæˆ |
| Phase 5 | UX æµç¨‹å¯©æŸ¥ï¼šå…¨è§’è‰² UX æª¢è¦– + 11 é …ä¿®å¾©ï¼ˆè·¯ç”±å®ˆè¡› + SSO è‡ªå‹•è­˜åˆ¥ + æ¬Šé™ DI çµ±ä¸€ + UI å¢å¼·ï¼‰ | âœ… å®Œæˆ |
| Phase 6 | AI å¼•æ“å‡ç´šï¼šLlamaParse æ™ºæ…§è§£æ + jieba åˆ†è© + HyDE æŸ¥è©¢æ“´å±• + LLM ç­”æ¡ˆç”Ÿæˆ + Chunk å»é‡ | âœ… å®Œæˆ |
| Phase 7 | å°è©±é«”é©—å‡ç´šï¼šSSE ä¸²æµ + Markdown æ¸²æŸ“ + ä¾†æºé¢æ¿ + å›é¥‹ç³»çµ± + RAG å„€è¡¨æ¿ + è¡Œå‹•ç‰ˆéŸ¿æ‡‰å¼ï¼ˆ15 ä»»å‹™ï¼‰ | âœ… å®Œæˆ |
| Phase 8 | ç”Ÿç”¢å®‰å…¨åŠ å›ºï¼šconfig.py å•Ÿå‹•é©—è­‰å™¨ + å¯†é‘°ç”Ÿæˆå·¥å…· + docker-compose.prod.yml å¼·åŒ–ï¼ˆ15 é …å®‰å…¨ç‰¹æ€§ï¼‰ | âœ… å®Œæˆ |

### Phase 8 ä»»å‹™æ¸…å–®ï¼ˆç”Ÿç”¢å®‰å…¨åŠ å›º â€” å®Œæˆï¼‰

| é …ç›® | èªªæ˜ | ç‹€æ…‹ |
|------|------|------|
| SEC-1 | config.py æ–°å¢ `model_validator`ï¼Œç”Ÿç”¢ç’°å¢ƒè‡ªå‹•æª¢æŸ¥ SECRET_KEY / POSTGRES_PASSWORD æ˜¯å¦å®‰å…¨ | âœ… |
| SEC-2 | æ–°å¢ `FIRST_SUPERUSER_EMAIL` / `FIRST_SUPERUSER_PASSWORD` é…ç½®ï¼Œå–ä»£ç¡¬ç·¨ç¢¼ `admin@example.com / admin123` | âœ… |
| SEC-3 | `scripts/initial_data.py` æ”¹ç‚ºè®€å– `settings.FIRST_SUPERUSER_*`ï¼Œä½¿ç”¨é è¨­å€¼æ™‚ç™¼å‡ºè­¦å‘Š | âœ… |
| SEC-4 | `scripts/generate_secrets.py` â€” ä¸€éµç”Ÿæˆ SECRET_KEY / DB å¯†ç¢¼ / Redis å¯†ç¢¼ç­‰ï¼Œæ”¯æ´è‡ªå‹•å¯«å…¥ `.env.production` | âœ… |
| SEC-5 | `docker-compose.prod.yml` é‡å¯«ï¼šç§»é™¤ `--reload`ã€ç§»é™¤ `.:/code` volume mountã€æ”¹ç”¨ pgvector æ­£ç¢ºæ˜ åƒ | âœ… |
| SEC-6 | ç”Ÿç”¢ç’°å¢ƒ Redis åŠ å…¥ `--requirepass` + `maxmemory` + AOF æŒä¹…åŒ– | âœ… |
| SEC-7 | PostgreSQL å¯†ç¢¼æ”¹ç”¨ `:?` èªæ³•å¼·åˆ¶å¿…å¡«æª¢æŸ¥ | âœ… |
| SEC-8 | æ‰€æœ‰å®¹å™¨åŠ å…¥ `healthcheck` + `restart: always` + è³‡æºé™åˆ¶ | âœ… |
| SEC-9 | æ—¥èªŒè¼ªæ›¿è¨­å®šï¼ˆjson-file + max-size 50m + max-file 5ï¼‰ | âœ… |
| SEC-10 | æ–°å¢ `uploads_data` named volumeï¼Œå–ä»£ `.:/code` æ›è¼‰ | âœ… |
| SEC-11 | Celery worker åŠ å…¥ `--max-tasks-per-child=200` é˜²è¨˜æ†¶é«”æ´©æ¼ | âœ… |
| SEC-12 | `.env.production.example` å®Œæ•´æ¨¡æ¿ï¼Œå«æ‰€æœ‰å¿…å¡«æ¬„ä½æ¨™è¨» + ç”Ÿæˆå¯†é‘°æŒ‡ä»¤ | âœ… |
| SEC-13 | `docker-compose.production.yml`ï¼ˆoverride ç‰ˆæœ¬ï¼‰åŒæ­¥æ›´æ–° | âœ… |
| SEC-14 | README.md æ–°å¢ã€Œç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²ã€ç« ç¯€ï¼Œå« 5 æ­¥é©Ÿè©³ç´°èªªæ˜ + å®‰å…¨æª¢æŸ¥æ¸…å–® | âœ… |
| SEC-15 | ç’°å¢ƒè®Šæ•¸ç« ç¯€é‡æ§‹ï¼Œä¾é¡åˆ¥åˆ†çµ„ï¼Œæ¨™è¨»å¿…å¡«é …ç›®èˆ‡å®‰å…¨è­¦å‘Š | âœ… |

### Phase 7 ä»»å‹™æ¸…å–®ï¼ˆå°è©±é«”é©—å‡ç´š â€” 15/15 å®Œæˆï¼‰

| é …ç›® | èªªæ˜ | å„ªå…ˆç´š | ç‹€æ…‹ |
|------|------|--------|------|
| T7-0 | Orchestrator é‡æ§‹ï¼šretrieve_contextã€stream_answerã€contextualize_query ä¸‰éšæ®µåˆ†é›¢ | P0 | âœ… |
| T7-1 | SSE ä¸²æµå¾Œç«¯ + å‰ç«¯ ReadableStream è§£æå™¨ï¼ˆstatus/sources/token/suggestions/done/error äº‹ä»¶ï¼‰ | P0 | âœ… |
| T7-2 | å¤šè¼ªå°è©±ä¸Šä¸‹æ–‡ï¼šæ­·å²è¨Šæ¯æ³¨å…¥ + query contextualizationï¼ˆæ”¹å¯«æŸ¥è©¢ï¼‰ | P0 | âœ… |
| T7-3 | Markdown æ¸²æŸ“å™¨ï¼šreact-markdown + remark-gfmï¼ˆè¡¨æ ¼ï¼‰+ rehype-highlightï¼ˆç¨‹å¼ç¢¼é«˜äº®ï¼‰ | P1 | âœ… |
| T7-4 | ä¾†æºé¢æ¿ï¼šå¯å±•é–‹çš„åƒè€ƒä¾†æºé¡¯ç¤ºï¼Œå€åˆ† policy/lawï¼Œå«ç›¸ä¼¼åº¦è©•åˆ†èˆ‡æ‘˜è¦ | P1 | âœ… |
| T7-5 | ä½¿ç”¨è€…å›é¥‹ç³»çµ±ï¼šè³‡æ–™æ¨¡å‹ + API ç«¯é» + å‰ç«¯ FeedbackButtonsï¼ˆğŸ‘ğŸ‘ï¼‰ | P1 | âœ… |
| T7-6 | å¾ŒçºŒå»ºè­°ï¼šLLM è§£æç”Ÿæˆ 3 å€‹è¿½å•å»ºè­° + å‰ç«¯é»æ“Šè‡ªå‹•å¡«å…¥ | P2 | âœ… |
| T7-9 | è¡Œå‹•ç‰ˆéŸ¿æ‡‰å¼ï¼šæ¼¢å ¡é¸å–® + å´é‚Šæ¬„è¦†è“‹å±¤ + è§¸æ§å‹å–„ UI | P2 | âœ… |
| T7-11 | å°è©±åŒ¯å‡ºï¼šMarkdown æ ¼å¼åŒ¯å‡ºï¼Œå«æ™‚é–“æˆ³ã€ä¾†æºã€è©•åˆ† | P2 | âœ… |
| T7-12 | RAG å„€è¡¨æ¿ï¼šå°è©±é‡ã€å»¶é² P50/P95ã€å›é¥‹çµ±è¨ˆã€æ¯æ—¥è¶¨å‹¢åœ–è¡¨ï¼ˆRechartsï¼‰ | P1 | âœ… |
| T7-13 | å°è©±æœå°‹ï¼šé—œéµå­—æª¢ç´¢æ­·å²å°è©±ï¼Œé¡¯ç¤ºæ‘˜è¦èˆ‡æ™‚é–“ | P2 | âœ… |
| T7-14 | æ‰“å­—æŒ‡ç¤ºå™¨ï¼šAI æ€è€ƒä¸­çš„å‹•ç•«æ•ˆæœ | P3 | âœ… |
| T7-X | ä¾†æºè³‡æ–™çµæ§‹ä¿®å¾©ï¼šbackend èˆ‡ frontend ChatSource å‹åˆ¥å°é½Šï¼ˆpolicy/law + title/snippetï¼‰ | P0 | âœ… |
| T7-Y | æœå°‹æ¬„ä½ä¿®å¾©ï¼šsearch API è¿”å› snippet æ¬„ä½è€Œé content | P0 | âœ… |
| T7-Z | SSE éŒ¯èª¤è™•ç†ä¿®å¾©ï¼šéŒ¯èª¤äº‹ä»¶è§¸ç™¼æ™‚ä¸­æ­¢è¨Šæ¯æäº¤ï¼Œé¿å…ç©ºç™½å°è©± | P0 | âœ… |

### Phase 6 ä»»å‹™æ¸…å–®ï¼ˆAI å¼•æ“å‡ç´š â€” 7/7 å®Œæˆï¼‰

| é …ç›® | èªªæ˜ | å„ªå…ˆç´š | ç‹€æ…‹ |
|------|------|--------|------|
| AI-1 | LlamaParse æ•´åˆï¼š10 ç¨®æ ¼å¼æ™ºæ…§è§£æ + å“è³ªé™ç´šæ©Ÿåˆ¶ | P0 | âœ… |
| AI-2 | PPT/PPTX è§£ææ”¯æ´ï¼ˆLlamaParse + python-pptx é™ç´šï¼‰ | P0 | âœ… |
| AI-3 | URL ç¶²é å…§å®¹æ“·å–ï¼ˆtrafilaturaï¼‰ | P1 | âœ… |
| AI-4 | jieba ä¸­æ–‡è©ç´šåˆ†è©ï¼ˆå–ä»£é€å­—åˆ‡åˆ†ï¼‰ | P0 | âœ… |
| AI-5 | HyDE æŸ¥è©¢æ“´å±•ï¼ˆåƒ…èªæ„/æ··åˆæ¨¡å¼ï¼Œä¸å½±éŸ¿ BM25ï¼‰ | P1 | âœ… |
| AI-6 | LLM ç­”æ¡ˆç”Ÿæˆï¼ˆOpenAI GPT-4o-mini + Fallback æ¨¡æ¿ï¼‰ | P0 | âœ… |
| AI-7 | Per-document Chunk å»é‡ï¼ˆSHA256 é›œæ¹Šï¼‰ | P2 | âœ… |

### Phase 5 ä»»å‹™æ¸…å–®ï¼ˆUX æµç¨‹å…¨è§’è‰²æª¢è¦– â€” 11/11 å®Œæˆï¼‰

| é …ç›® | èªªæ˜ | å„ªå…ˆç´š | ç‹€æ…‹ |
|------|------|--------|------|
| UX-1 | `CustomDomainsPage` â€” è‡ªè¨‚åŸŸå CRUD + DNS é©—è­‰å¼•å° | P0 | âœ… |
| UX-2 | `RegionsPage` â€” å€åŸŸè³‡è¨Š + è³‡æ–™é§ç•™åˆè¦é¡¯ç¤º | P0 | âœ… |
| UX-3 | `RoleGuard` å‰ç«¯è·¯ç”±è§’è‰²å®ˆè¡›ï¼Œä¿è­·æ‰€æœ‰ç®¡ç†é é¢ | P1 | âœ… |
| UX-4 | `MyUsagePage` â€” æ‰€æœ‰è§’è‰²å€‹äººç”¨é‡çµ±è¨ˆ | P2 | âœ… |
| UX-5 | SSO ç™»å…¥æ”¹ Email è‡ªå‹•è­˜åˆ¥ + å¾Œç«¯ discover ç«¯é» | P2 | âœ… |
| UX-6 | æ–‡ä»¶é é¢æ–°å¢éƒ¨é–€ç¯©é¸åŠŸèƒ½ï¼ˆå‰ç«¯ + å¾Œç«¯ï¼‰ | P2 | âœ… |
| UX-7 | å“ç‰Œè¨­å®šæ–°å¢å³æ™‚å´é‚Šæ¬„é è¦½ | P3 | âœ… |
| UX-8 | è¨‚é–±å‡ç´šæ”¹ç”¨ Modal ç¢ºèªï¼ˆæ–¹æ¡ˆå°æ¯” / åƒ¹æ ¼ / åŠŸèƒ½å·®ç•°ï¼‰ | P3 | âœ… |
| UX-9 | å¾Œç«¯æ¬Šé™çµ±ä¸€ç‚º DI â€” 19 ç«¯é»æ”¹ç”¨ `Depends(require_admin)` | P3 | âœ… |
| UX-10 | éƒ¨é–€ç®¡ç†æ”¹ç‚ºæ¨¹ç‹€å±¤ç´šçµæ§‹ï¼ˆå¯æ”¶åˆ + parent_id é¸æ“‡ï¼‰ | P3 | âœ… |
| UX-11 | UX æµç¨‹æª¢è¦–å ±å‘Šæ–‡ä»¶ï¼ˆ`docs/UX_FLOW_REVIEW.md`ï¼‰ | â€” | âœ… |

> å®Œæ•´å ±å‘Šå« Mermaid æµç¨‹åœ–ã€è§’è‰²å¯è¦‹æ€§çŸ©é™£ã€å•é¡Œç›¤é»ï¼Œè«‹åƒé–± [docs/UX_FLOW_REVIEW.md](docs/UX_FLOW_REVIEW.md)ã€‚

### Phase 4 ä»»å‹™æ¸…å–®ï¼ˆ22/22 å®Œæˆï¼‰

| ä»»å‹™ | èªªæ˜ | ç‹€æ…‹ |
|------|------|------|
| T4-1 | Docker ç”Ÿç”¢éƒ¨ç½² + ç’°å¢ƒåˆ†é›¢ | âœ… |
| T4-2 | CI/CD Pipelineï¼ˆGitHub Actionsï¼‰ | âœ… |
| T4-3 | ç™½æ¨™å“ç‰Œç³»çµ±ï¼ˆLogo / è‰²å½© / åç¨±ï¼‰ | âœ… |
| T4-4 | Admin å‰å¾Œå°åˆ†é›¢ï¼ˆç¨ç«‹å¾®æœå‹™ï¼‰ | âœ… |
| T4-5 | Admin å‰ç«¯ SPA | âœ… |
| T4-6 | è‡ªè¨‚ç¶²åŸŸï¼ˆCNAME é©—è­‰ï¼‰ | âœ… |
| T4-7 | è¨‚é–±æ–¹æ¡ˆç®¡ç† | âœ… |
| T4-8 | å®‰å…¨ç¨½æ ¸å¼·åŒ– | âœ… |
| T4-9 | æ•ˆèƒ½å„ªåŒ–ï¼ˆé€£ç·šæ±  + å¿«å–ï¼‰ | âœ… |
| T4-10 | Nginx åå‘ä»£ç†é–˜é“ | âœ… |
| T4-11 | ç›£æ§èˆ‡å‘Šè­¦ï¼ˆPrometheus + Grafanaï¼‰ | âœ… |
| T4-12 | è² è¼‰æ¸¬è©¦ï¼ˆLocust + k6ï¼‰ | âœ… |
| T4-13 | æ–‡ä»¶æ’°å¯«ï¼ˆä½¿ç”¨è€…æ‰‹å†Š + API æŒ‡å— + ç¶­é‹ SOPï¼‰ | âœ… |
| T4-14 | API é–‹ç™¼è€…æ•´åˆæŒ‡å— | âœ… |
| T4-15 | è³‡æ–™åº«ç´¢å¼•å„ªåŒ– | âœ… |
| T4-18 | Celery ä»»å‹™ç›£æ§ | âœ… |
| T4-19 | å¤šå€åŸŸéƒ¨ç½²æ¶æ§‹ | âœ… |
| T4-20 | PostgreSQL æ•ˆèƒ½èª¿å„ª | âœ… |
| T4-21 | Nginx é€²éšå®‰å…¨ Headers | âœ… |
| T4-22 | å¤šç’°å¢ƒéƒ¨ç½²è¨­å®š | âœ… |

è©³ç´°ä»»å‹™æ¸…å–®èˆ‡ç”¢å“è¦æ ¼è«‹åƒé–± [docs/PROJECT_PLAN.md](docs/PROJECT_PLAN.md)ã€‚

---

## æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | èªªæ˜ |
|------|------|
| [docs/PROJECT_PLAN.md](docs/PROJECT_PLAN.md) | å®Œæ•´ç”¢å“è¦æ ¼æ›¸èˆ‡é–‹ç™¼è¨ˆç•« |
| [docs/API_GUIDE.md](docs/API_GUIDE.md) | API ä½¿ç”¨æŒ‡å— |
| [docs/API_DEVELOPER_GUIDE.md](docs/API_DEVELOPER_GUIDE.md) | API é–‹ç™¼è€…æ•´åˆæŒ‡å—ï¼ˆå« SDK ç¯„ä¾‹ï¼‰ |
| [docs/USER_MANUAL.md](docs/USER_MANUAL.md) | ä½¿ç”¨è€…æ“ä½œæ‰‹å†Š |
| [docs/OPS_SOP.md](docs/OPS_SOP.md) | ç¶­é‹æ¨™æº–ä½œæ¥­ç¨‹åºï¼ˆSOPï¼‰ |
| [docs/MULTI_REGION.md](docs/MULTI_REGION.md) | å¤šå€åŸŸéƒ¨ç½²æŒ‡å— |
| [docs/UX_FLOW_REVIEW.md](docs/UX_FLOW_REVIEW.md) | UX æµç¨‹å…¨è§’è‰²æª¢è¦–å ±å‘Šï¼ˆå« Mermaid åœ–è¡¨ï¼‰ |
| [docs/PHASE7_UPGRADE_PROPOSAL.md](docs/PHASE7_UPGRADE_PROPOSAL.md) | Phase 7 å‡ç´šææ¡ˆï¼ˆå°è©±é«”é©—å‡ç´šï¼‰ |
| [tests/load/README.md](tests/load/README.md) | è² è¼‰æ¸¬è©¦èªªæ˜ |

---

## æˆæ¬Š

æœ¬å°ˆæ¡ˆç‚ºç§æœ‰å°ˆæ¡ˆï¼Œæœªç¶“æˆæ¬Šä¸å¾—è¤‡è£½æˆ–åˆ†ç™¼ã€‚
